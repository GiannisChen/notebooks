## è…¾è®¯éŸ³ä¹ç¬”è¯• 2023-04-13åœº



> åªèƒ½è¯´ï¼Œéš¾åº¦å€’æ’ä¹Ÿç®—æ˜¯ä¸€ç§æ½®æµäº†ï¼ŸğŸ¤®



### ç¬¬ä¸€é¢˜

è§„å®šä¸€ä¸ª**å¥½æ•°ç»„**ï¼š

- æ•°ç»„ä¸­çš„å…ƒç´ åªæœ‰0ï¼Œ1ï¼Œ2ï¼›
- æ•°ç»„ä¸­ä»»æ„ä¸¤ä¸ªç›¸é‚»çš„æ•°å­—éƒ½ä¸ç›¸åŒï¼›

å®šä¹‰ä¸€ä¸ªæ•°ç»„çš„æƒå€¼æ˜¯ç›¸é‚»ä¸¤ä¸ªæ•°å­—çš„ç»å¯¹å€¼ä¹‹å’Œã€‚ä¾‹å¦‚æ•°ç»„`1, 3, 2, 4, 1`ï¼Œåˆ™æœ‰æƒå€¼ä¸ºï¼š$W = |3-1|+|2-3|+|4-2|+|1-4|=8$

é‚£ä¹ˆï¼Œæ±‚æ‰€æœ‰é•¿åº¦ä¸º$n$çš„çš„**å¥½æ•°ç»„**çš„æƒå€¼ä¹‹å’Œï¼Œ**ç»“æœå–$10^9+7$çš„æ¨¡**ã€‚

- $1 \le n \le 10^9$



#### æ€è·¯

æˆ‘ä»¬åº”ç”¨ä¸€ä¸‹é€’æ¨çš„æ€æƒ³ï¼Œå› ä¸ºä¸éš¾å‘ç°ï¼Œæ•°ç»„$n_{k+1}$æ˜¯ç”±æ•°ç»„$n_k$å‘å±•è€Œæ¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æšä¸¾ä¸€ä¸‹æ•°ç»„$n_k$çš„æœ«å°¾ï¼Œè‚¯å®šåªæœ‰ä¸‰ä¸ªæ•°å­—ï¼Œä»–ä»¬å„è‡ªå¯¹$n_{k+1}$æœ‰ä»€ä¹ˆè´¡çŒ®å‘¢ï¼š

![20230313-tme-1-example01](images/20230413-tme-1-example01.svg)

æ¯ä¸ªæ•°å­—çš„è´¡çŒ®ä¹‹å’Œæ˜¯$8$ï¼Œåˆç”±äº**å¥½æ•°ç»„**çš„å®šä¹‰ï¼Œä»»æ„ç›¸é‚»çš„æ•°å­—ä¸ç›¸åŒï¼Œåˆ™å½“æ•°ç»„$n_k$çš„æœ«å°¾ä¸º$0$ï¼Œé‚£ä¹ˆç»™æ•°ç»„$n_{k+1}$çš„è´¡çŒ®å°±æ˜¯2ä¸ªï¼š$01$å’Œ$02$ï¼Œå‰$k-1$çš„æ•°ç»„åˆ‡ç‰‡æ˜¯å¼ å¾—ä¸€æ ·çš„ã€‚é‚£ä¹ˆä¸éš¾å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š
$$
\begin{aligned}
n_{k+1} &= 2 n_k + 8 \times 2^{k-1} 
\end{aligned}
$$
å…¶ä¸­ä¸ºä»€ä¹ˆæ˜¯$2^{k-1}$å‘¢ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå½“$n_1$æ—¶ï¼Œå…±è®¡ä¸‰ç§ï¼š`{0, 1, 2}`ï¼Œå¯¹äº$n_2$çš„è´¡çŒ®åˆ†åˆ«æ˜¯1æ¬¡ï¼Œåˆ™æ˜¯$2^0$ï¼›åˆ°$n_2$æ—¶ï¼Œå…±è®¡å…­ç§ï¼š`{01, 02, 10, 12, 20, 21}`ï¼Œé‚£ä¹ˆå¯¹äº$n_3$çš„è´¡çŒ®åˆ†åˆ«æ˜¯2æ¬¡ï¼Œåˆ™æ˜¯$2^1$ã€‚

æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡è¿™ä¸ªé€’æ¨å…¬å¼å¾€ä¸‹æ¨äº†ï¼š
$$
\begin{aligned}
n_{k+1} &= 2 n_k + 8 \times 2^{k-1}  \\
		&= 2(2n_{k-1}+8 \times 2^{k-2}) + 8 \times 2^{k-1} &= 4 n_k + 2 \times 8 \times 2^{k-1} \\
		&= 4(2n_{k-2}+8 \times 2^{k-3}) + 2 \times 8 \times 2^{k-1} &= 8 n_{k-1} + 3 \times 8 \times 2^{k-1} \\
		&= \cdots &= 2^{k-1}n_2+(k-1) \times 8 \times 2^{k-1} \\
		&= 2^{k-1} \times 8 = (k-1) \times 2^{k+2} &= k \times 2^{k+2} \\
\end{aligned}
$$
æ‰€ä»¥æœ‰ï¼š
$$
n_k = (k-1) \times 2^{k+1}
$$
æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿä½†æ˜¯æœ¬é¢˜å…¶å®è¿˜æ²¡æœ‰å®Œç»“ï¼Œæˆ‘ä»¬å†å›å¤´çœ‹ä¸€ä¸‹$n$çš„èŒƒå›´ï¼Œå¥½å®¶ä¼™ï¼Œç»å¯¹è¶…äº†`int64`ï¼Œé‚£ä¹˜æ³•æˆ‘ä»¬è¿˜ä¸èƒ½ç›´æ¥ç”¨ï¼Œå¾—åšä¸ªå°æ“ä½œâ€”â€”äºŒåˆ†æ±‚$2^{k+1}$ï¼ŒåŒæ—¶å–æ¨¡ï¼š`(2**s) % (1e9+7) == (2**(s/2))**2 * 2**(s%2)`ã€‚

è‡³æ­¤ï¼Œå…¨ä½“çš„å‘æ‰ç®—å…¨ç»•è¿‡äº†ã€‚



#### ä»£ç 

```go
func fun(n int) int {
	mod := int64(1e9 + 7)
	sum := int64(n-1) % mod
	k := int64(n + 1)
	var dfs func(i int64) int64
	dfs = func(i int64) int64 {
		if i == 0 {
			return 1
		}
		num := dfs(i / 2)
		num = (num * num) % mod
		if i%2 == 1 {
			num = (num * 2) % mod
		}
		return num
	}

	return int((sum * dfs(k)) % mod)
}
```



#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ï¼š$O(\log n)$
- ç©ºé—´å¤æ‚åº¦ï¼š$O(\log n)$ï¼ˆé€’å½’æ ˆï¼‰



### ç¬¬äºŒé¢˜

ç»™ä¸€æ£µäºŒå‰æ ‘ï¼ŒèŠ‚ç‚¹ä¸ªæ•°ä¸º$n$ï¼ŒèŠ‚ç‚¹ä¸Šéƒ½æœ‰æƒå€¼$w$ï¼Œæ›¿æ¢æƒå€¼ä¸ºï¼šä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘çš„æ‰€æœ‰æƒå€¼ä¹‹ç§¯çš„**æœ«å°¾é›¶çš„ä¸ªæ•°**ã€‚



#### æ€è·¯

![20230413-tme-2-example01](images/20230413-tme-2-example01.svg)

åˆæ˜¯é›¶ï¼Œè‡ªç„¶æƒ³åˆ°$2 \times 5$ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦**é€’å½’+å›æº¯**ç»Ÿè®¡2å’Œ5çš„ä¸ªæ•°å°±è¡Œäº†ï¼Œç®€å•çš„`DFS`ï¼Œæ²¡ä»€ä¹ˆéš¾åº¦ã€‚



#### ä»£ç 

```go
type TreeNode struct {
	Val   int
	Left  *TreeNode
	Right *TreeNode
}

func valueOfTree(root *TreeNode) *TreeNode {
	var dfs func(node *TreeNode) (int, int)
	dfs = func(node *TreeNode) (two int, five int) {
		if node == nil {
			return 0, 0
		}

		two, five = count(node.Val)
		t, f := dfs(node.Left)
		two += t
		five += f
		t, f = dfs(node.Right)
		two += t
		five += f
		if two > five {
			node.Val = five
		} else {
			node.Val = two
		}

		return two, five
	}

	dfs(root)

	return root
}

func count(num int) (two, five int) {
	if num == 0 {
		return 0, 0
	}
	for num%2 == 0 {
		num /= 2
		two++
	}
	for num%5 == 0 {
		num /= 5
		five++
	}
	return two, five
}
```



#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log w)$
- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$



### ç¬¬ä¸‰é¢˜

æ„å»ºä¸€ä¸ªå¤§å°ä¸º$\frac{n \times (n+1)}{2}$çš„æ•°ç»„ï¼Œå…¶ä¸­æœ‰1ä¸ª1ï¼Œ2ä¸ª2ï¼Œâ€¦â€¦ï¼Œnä¸ªnï¼Œä½†æ˜¯ç›¸é‚»æ•°å­—ä¸ç›¸åŒã€‚æ±‚å…¶ä¸­ä¸€ä¸ªæ•°ç»„ï¼ˆä»»æ„ä¸€ä¸ªè¿”å›ï¼‰ã€‚



#### æ€è·¯

ä»¥$n=6$ä¸ºä¾‹ï¼š`654321_65432_6543_654_65_6`ï¼Œè¿˜çœ‹ä¸å‡ºæ¥ï¼Ÿçœ‹ä»£ç å§ã€‚



#### ä»£ç 

```go
func fun(n int) []int {
	idx := 0
	ans := make([]int, (n*(n+1))/2)
	for i := 1; i <= n; i++ {
		for j := n; j >= i; j-- {
			ans[idx] = j
			idx++
		}
	}
	return ans
}
```



#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$
- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$
