## ç‰¹æ®Šä¹‹å¤„ï¼ˆSpecialnessï¼‰

- **Rust** ä¹‹æ‰€ä»¥èƒ½æˆä¸ºä¸‡ä¼—ç©ç›®çš„è¯­è¨€ï¼Œå°±æ˜¯å› ä¸ºå…¶å†…å­˜å®‰å…¨æ€§ã€‚åœ¨ä»¥å¾€ï¼Œå†…å­˜å®‰å…¨å‡ ä¹éƒ½æ˜¯é€šè¿‡ GC çš„æ–¹å¼å®ç°ï¼Œä½†æ˜¯ GC ä¼šå¼•æ¥æ€§èƒ½ã€å†…å­˜å ç”¨ä»¥åŠ **Stop the world** ç­‰é—®é¢˜ï¼Œåœ¨é«˜æ€§èƒ½åœºæ™¯å’Œç³»ç»Ÿç¼–ç¨‹ä¸Šæ˜¯ä¸å¯æ¥å—çš„ï¼Œå› æ­¤ **Rust** é‡‡ç”¨äº†ä¸ä¼—ä¸åŒï¼ˆä¸‡æ¶ä¹‹æºï¼‰çš„æ–¹å¼ï¼š**æ‰€æœ‰æƒç³»ç»Ÿ**ã€‚



### æ‰€æœ‰æƒ

- æ‰€æœ‰çš„ç¨‹åºéƒ½å¿…é¡»å’Œè®¡ç®—æœºå†…å­˜æ‰“äº¤é“ï¼Œå¦‚ä½•ä»å†…å­˜ä¸­ç”³è¯·ç©ºé—´æ¥å­˜æ”¾ç¨‹åºçš„è¿è¡Œå†…å®¹ï¼Œå¦‚ä½•åœ¨ä¸éœ€è¦çš„æ—¶å€™é‡Šæ”¾è¿™äº›ç©ºé—´ï¼Œæˆäº†é‡ä¸­ä¹‹é‡ï¼Œä¹Ÿæ˜¯æ‰€æœ‰ç¼–ç¨‹è¯­è¨€è®¾è®¡çš„éš¾ç‚¹ä¹‹ä¸€ã€‚åœ¨è®¡ç®—æœºè¯­è¨€ä¸æ–­æ¼”å˜è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†ä¸‰ç§æµæ´¾ï¼š

  - **åƒåœ¾å›æ”¶æœºåˆ¶(GC)** â€”â€” åœ¨ç¨‹åºè¿è¡Œæ—¶ä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œå…¸å‹ä»£è¡¨ï¼šJavaã€Goï¼›
  - **æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾** â€”â€” åœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡å‡½æ•°è°ƒç”¨çš„æ–¹å¼æ¥ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œå…¸å‹ä»£è¡¨ï¼šC++ï¼›
  - **é€šè¿‡æ‰€æœ‰æƒæ¥ç®¡ç†å†…å­˜** â€”â€” ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—è§„åˆ™è¿›è¡Œæ£€æŸ¥ï¼›

  å…¶ä¸­ **Rust** é€‰æ‹©äº†ç¬¬ä¸‰ç§ï¼Œæœ€å¦™çš„æ˜¯ï¼Œè¿™ç§æ£€æŸ¥åªå‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼Œå› æ­¤å¯¹äºç¨‹åºè¿è¡ŒæœŸï¼Œä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½ä¸Šçš„æŸå¤±ã€‚

- è®©æˆ‘ä»¬ä»**ä¸€æ®µä¸å®‰å…¨çš„ä»£ç **å¼€å§‹ï¼šğŸ‘‡

  ```c
  int* foo() {
      int a;          // å˜é‡açš„ä½œç”¨åŸŸå¼€å§‹
      a = 100;
      char *c = "xyz";   // å˜é‡cçš„ä½œç”¨åŸŸå¼€å§‹
      return &a;
  }                   // å˜é‡aå’Œcçš„ä½œç”¨åŸŸç»“æŸ
  ```

  - è¿™æ®µä»£ç è™½ç„¶å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯å…¶å®éå¸¸ç³Ÿç³•ï¼Œå˜é‡ `a` å’Œ `c` éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œå‡½æ•°ç»“æŸåå°†å±€éƒ¨å˜é‡ `a` çš„åœ°å€è¿”å›ï¼Œä½†å±€éƒ¨å˜é‡ `a` å­˜åœ¨æ ˆä¸­ï¼Œåœ¨ç¦»å¼€ä½œç”¨åŸŸåï¼Œ`a` æ‰€ç”³è¯·çš„æ ˆä¸Šå†…å­˜éƒ½ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œä»è€Œé€ æˆäº† **æ‚¬ç©ºæŒ‡é’ˆ**ï¼ˆ**Dangling Pointer**ï¼‰ çš„é—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„å†…å­˜å®‰å…¨é—®é¢˜ï¼Œè™½ç„¶ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯è¿è¡Œçš„æ—¶å€™ä¼šå‡ºç°é”™è¯¯ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½å­˜åœ¨ã€‚
  - å†æ¥çœ‹å˜é‡ `c`ï¼Œ`c` çš„å€¼æ˜¯å¸¸é‡å­—ç¬¦ä¸²ï¼Œå­˜å‚¨äºå¸¸é‡åŒºï¼Œå¯èƒ½è¿™ä¸ªå‡½æ•°æˆ‘ä»¬åªè°ƒç”¨äº†ä¸€æ¬¡ï¼Œä¹Ÿå¯èƒ½æˆ‘ä»¬ä¸å†ä¼šä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä½† `"xyz"` åªæœ‰å½“æ•´ä¸ªç¨‹åºç»“æŸåç³»ç»Ÿæ‰èƒ½å›æ”¶è¿™ç‰‡å†…å­˜ã€‚

- æ‰€ä»¥å†…å­˜å®‰å…¨é—®é¢˜ï¼Œä¸€ç›´éƒ½æ˜¯ç¨‹åºå‘˜éå¸¸å¤´ç–¼çš„é—®é¢˜ï¼Œå¥½åœ¨, åœ¨ **Rust** ä¸­è¿™äº›é—®é¢˜å³å°†æˆä¸ºå†å²ï¼Œå› ä¸º **Rust** åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘ç°å†…å­˜ä¸å®‰å…¨çš„é—®é¢˜ï¼Œé‚£ **Rust** å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿåœ¨æ­£å¼è¿›å…¥ä¸»é¢˜å‰ï¼Œå…ˆæ¥ä¸€ä¸ªé¢„çƒ­çŸ¥è¯†ã€‚



#### æ ˆï¼ˆStackï¼‰å’Œå †ï¼ˆHeapï¼‰

- æ ˆå’Œå †æ˜¯ç¼–ç¨‹è¯­è¨€æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼Œè€Œæ ˆå’Œå †çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯ä¸ºç¨‹åºåœ¨è¿è¡Œæ—¶æä¾›å¯ä¾›ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚ä½†æ˜¯åœ¨å¾ˆå¤šè¯­è¨€ä¸­ï¼Œä½ å¹¶ä¸éœ€è¦æ·±å…¥äº†è§£æ ˆä¸å †ã€‚ å¯¹äº **Rust** è¿™æ ·çš„ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œå€¼æ˜¯ä½äºæ ˆä¸Šè¿˜æ˜¯å †ä¸Šéå¸¸é‡è¦, å› ä¸ºè¿™ä¼šå½±å“ç¨‹åºçš„è¡Œä¸ºå’Œæ€§èƒ½ã€‚

##### æ ˆ

- æ ˆæŒ‰ç…§é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åé¡ºåºå–å‡ºå€¼ï¼Œè¿™ä¹Ÿè¢«ç§°ä½œ**åè¿›å…ˆå‡º**ã€‚å¢åŠ æ•°æ®å«åš**è¿›æ ˆ**ï¼Œç§»å‡ºæ•°æ®åˆ™å«åš**å‡ºæ ˆ**ã€‚
- å› ä¸ºä¸Šè¿°çš„å®ç°æ–¹å¼ï¼Œæ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå‡è®¾æ•°æ®å¤§å°æ˜¯æœªçŸ¥çš„ï¼Œé‚£ä¹ˆåœ¨å–å‡ºæ•°æ®æ—¶ï¼Œä½ å°†æ— æ³•å–åˆ°ä½ æƒ³è¦çš„æ•°æ®ã€‚

##### å †

- ä¸æ ˆä¸åŒï¼Œå¯¹äºå¤§å°æœªçŸ¥æˆ–è€…å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒå­˜å‚¨åœ¨å †ä¸Šã€‚
  1. å½“å‘å †ä¸Šæ”¾å…¥æ•°æ®æ—¶ï¼Œéœ€è¦è¯·æ±‚ä¸€å®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚æ“ä½œç³»ç»Ÿåœ¨å †çš„æŸå¤„æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºä½ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä½ç½®åœ°å€çš„**æŒ‡é’ˆ**, è¯¥è¿‡ç¨‹è¢«ç§°ä¸º**åœ¨å †ä¸Šåˆ†é…å†…å­˜**ï¼Œæœ‰æ—¶ç®€ç§°ä¸º â€œ**åˆ†é…**â€ï¼ˆ**allocating**ï¼‰ã€‚
  2. æ¥ç€ï¼Œè¯¥æŒ‡é’ˆä¼šè¢«æ¨å…¥**æ ˆ**ä¸­ï¼Œå› ä¸ºæŒ‡é’ˆçš„å¤§å°æ˜¯å·²çŸ¥ä¸”å›ºå®šçš„ï¼Œåœ¨åç»­ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä½ å°†é€šè¿‡æ ˆä¸­çš„**æŒ‡é’ˆ**ï¼Œæ¥è·å–æ•°æ®åœ¨å †ä¸Šçš„å®é™…å†…å­˜ä½ç½®ï¼Œè¿›è€Œè®¿é—®è¯¥æ•°æ®ã€‚
- ç”±ä¸Šå¯çŸ¥ï¼Œå †æ˜¯ä¸€ç§ç¼ºä¹ç»„ç»‡çš„æ•°æ®ç»“æ„ã€‚æƒ³è±¡ä¸€ä¸‹å»é¤é¦†å°±åº§åƒé¥­ï¼šè¿›å…¥é¤é¦†ï¼Œå‘ŠçŸ¥æœåŠ¡å‘˜æœ‰å‡ ä¸ªäººï¼Œç„¶åæœåŠ¡å‘˜æ‰¾åˆ°ä¸€ä¸ªå¤Ÿå¤§çš„ç©ºæ¡Œå­ï¼ˆå †ä¸Šåˆ†é…çš„å†…å­˜ç©ºé—´ï¼‰å¹¶é¢†ä½ ä»¬è¿‡å»ã€‚å¦‚æœæœ‰äººæ¥è¿Ÿäº†ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¡Œå·ï¼ˆæ ˆä¸Šçš„æŒ‡é’ˆï¼‰æ¥æ‰¾åˆ°ä½ ä»¬ååœ¨å“ªã€‚

##### æ€§èƒ½åŒºåˆ«

- **å†™å…¥æ–¹é¢** â€”â€” å…¥æ ˆæ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºå…¥æ ˆæ—¶æ“ä½œç³»ç»Ÿæ— éœ€åˆ†é…æ–°çš„ç©ºé—´ï¼Œåªéœ€è¦å°†æ–°æ•°æ®æ”¾å…¥æ ˆé¡¶å³å¯ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜åˆ™éœ€è¦æ›´å¤šçš„å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿå¿…é¡»é¦–å…ˆæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œæ¥ç€åšä¸€äº›è®°å½•ä¸ºä¸‹ä¸€æ¬¡åˆ†é…åšå‡†å¤‡ã€‚
- **è¯»å–æ–¹é¢** â€”â€” å¾—ç›Šäº CPU é«˜é€Ÿç¼“å­˜ï¼Œä½¿å¾—å¤„ç†å™¨å¯ä»¥å‡å°‘å¯¹å†…å­˜çš„è®¿é—®ï¼Œé«˜é€Ÿç¼“å­˜å’Œå†…å­˜çš„è®¿é—®é€Ÿåº¦å·®å¼‚åœ¨ 10 å€ä»¥ä¸Šï¼æ ˆæ•°æ®å¾€å¾€å¯ä»¥ç›´æ¥å­˜å‚¨åœ¨ CPU é«˜é€Ÿç¼“å­˜ä¸­ï¼Œè€Œå †æ•°æ®åªèƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è®¿é—®å †ä¸Šçš„æ•°æ®æ¯”è®¿é—®æ ˆä¸Šçš„æ•°æ®æ…¢ï¼Œå› ä¸ºå¿…é¡»å…ˆè®¿é—®æ ˆå†é€šè¿‡æ ˆä¸Šçš„æŒ‡é’ˆæ¥è®¿é—®å†…å­˜ã€‚

- å› æ­¤ï¼Œå¤„ç†å™¨å¤„ç†å’Œåˆ†é…åœ¨æ ˆä¸Šæ•°æ®ä¼šæ¯”åœ¨å †ä¸Šçš„æ•°æ®æ›´åŠ é«˜æ•ˆã€‚

#### æ‰€æœ‰æƒä¸å †æ ˆ

- å½“ä½ çš„ä»£ç è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ï¼ˆåŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆå’Œå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼‰ä¾æ¬¡è¢«å‹å…¥æ ˆä¸­ï¼Œå½“å‡½æ•°è°ƒç”¨ç»“æŸæ—¶ï¼Œè¿™äº›å€¼å°†è¢«ä»æ ˆä¸­æŒ‰ç…§ç›¸åçš„é¡ºåºä¾æ¬¡ç§»é™¤ã€‚
- å› ä¸ºå †ä¸Šçš„æ•°æ®ç¼ºä¹ç»„ç»‡ï¼Œå› æ­¤è·Ÿè¸ªè¿™äº›æ•°æ®ä½•æ—¶åˆ†é…å’Œé‡Šæ”¾æ˜¯éå¸¸é‡è¦çš„ï¼Œå¦åˆ™å †ä¸Šçš„æ•°æ®å°†äº§ç”Ÿ**å†…å­˜æ³„æ¼** â€”â€” è¿™äº›æ•°æ®å°†æ°¸è¿œæ— æ³•è¢«å›æ”¶ã€‚è¿™å°±æ˜¯ **Rust** æ‰€æœ‰æƒç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å¼ºå¤§ä¿éšœã€‚
- å¯¹äºå…¶ä»–å¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼Œä½ ç¡®å®æ— éœ€ç†è§£å †æ ˆçš„åŸç†ï¼Œä½†æ˜¯**åœ¨ Rust ä¸­ï¼Œæ˜ç™½å †æ ˆçš„åŸç†ï¼Œå¯¹äºæˆ‘ä»¬ç†è§£æ‰€æœ‰æƒçš„å·¥ä½œåŸç†ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©**ã€‚



#### æ‰€æœ‰æƒåŸåˆ™

- ç†è§£äº†å †æ ˆï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹**å…³äºæ‰€æœ‰æƒçš„è§„åˆ™**ï¼Œé¦–å…ˆè¯·è°¨è®°ä»¥ä¸‹è§„åˆ™ï¼š

  > 1. **Rust** ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…ï¼›
  > 2. ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼›
  > 3. å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒï¼ˆdropï¼‰ï¼›

##### å˜é‡ä½œç”¨åŸŸ

- ä½œç”¨åŸŸæ˜¯ä¸€ä¸ªå˜é‡åœ¨ç¨‹åºä¸­æœ‰æ•ˆçš„èŒƒå›´, å‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ªå˜é‡ `s` ç»‘å®šåˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œè¯¥å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ç¡¬ç¼–ç åˆ°ç¨‹åºä»£ç ä¸­çš„ã€‚`s` å˜é‡ä»å£°æ˜çš„ç‚¹å¼€å§‹ç›´åˆ°å½“å‰ä½œç”¨åŸŸçš„ç»“æŸéƒ½æ˜¯æœ‰æ•ˆçš„ï¼š

  ```rust
  {                      // s åœ¨è¿™é‡Œæ— æ•ˆï¼Œå®ƒå°šæœªå£°æ˜
      let s = "hello";   // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„
      // ä½¿ç”¨ s
  }                      // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œsä¸å†æœ‰æ•ˆ
  ```

  ç®€è€Œè¨€ä¹‹ï¼Œ`s` ä»åˆ›å»ºä¼Šå§‹å°±å¼€å§‹æœ‰æ•ˆï¼Œç„¶åæœ‰æ•ˆæœŸæŒç»­åˆ°å®ƒç¦»å¼€ä½œç”¨åŸŸä¸ºæ­¢ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå°±ä½œç”¨åŸŸæ¥è¯´ï¼Œ**Rust** è¯­è¨€è·Ÿå…¶ä»–ç¼–ç¨‹è¯­è¨€æ²¡æœ‰åŒºåˆ«ã€‚

> - ä¹‹å‰æåˆ°è¿‡ï¼Œæœ¬ç« ä¼šç”¨ `String` ä½œä¸ºä¾‹å­ï¼Œå› æ­¤è¿™é‡Œä¼šè¿›è¡Œä¸€ä¸‹ç®€å•çš„ä»‹ç»ï¼Œå…·ä½“çš„ `String` å­¦ä¹ è¯·å‚è§ [String ç±»å‹](https://course.rs/basic/compound-type/string-slice.html)ã€‚
>
>   æˆ‘ä»¬å·²ç»è§è¿‡å­—ç¬¦ä¸²å­—é¢å€¼ `let s ="hello"`ï¼Œ`s` æ˜¯è¢«ç¡¬ç¼–ç è¿›ç¨‹åºé‡Œçš„å­—ç¬¦ä¸²å€¼ï¼ˆç±»å‹ä¸º `&str` ï¼‰ã€‚å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ã€‚åŸå› æœ‰äºŒï¼š
>
>   1. **å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ä¸å¯å˜çš„**ï¼Œå› ä¸ºè¢«ç¡¬ç¼–ç åˆ°ç¨‹åºä»£ç ä¸­ï¼›
>   2. å¹¶éæ‰€æœ‰å­—ç¬¦ä¸²çš„å€¼éƒ½èƒ½åœ¨ç¼–å†™ä»£ç æ—¶å¾—çŸ¥ï¼›
>
>   ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²æ˜¯éœ€è¦ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡ç”¨æˆ·åŠ¨æ€è¾“å…¥ç„¶åå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œè¿™ç§æƒ…å†µï¼Œå­—ç¬¦ä¸²å­—é¢å€¼å°±å®Œå…¨æ— ç”¨æ­¦ä¹‹åœ°ã€‚ ä¸ºæ­¤ï¼Œ**Rust** ä¸ºæˆ‘ä»¬æä¾›åŠ¨æ€å­—ç¬¦ä¸²ç±»å‹ï¼š `String`ï¼Œ**è¯¥ç±»å‹è¢«åˆ†é…åˆ°å †ä¸Š**ï¼Œå› æ­¤å¯ä»¥åŠ¨æ€ä¼¸ç¼©ï¼Œä¹Ÿå°±èƒ½å­˜å‚¨åœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬ã€‚
>
> - å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•åŸºäºå­—ç¬¦ä¸²å­—é¢é‡æ¥åˆ›å»º `String` ç±»å‹ï¼š
>
>   ```rust
>   let s = String::from("hello");
>   ```
>
>   `::` æ˜¯ä¸€ç§è°ƒç”¨æ“ä½œç¬¦ï¼Œè¿™é‡Œè¡¨ç¤ºè°ƒç”¨ `String` ä¸­çš„ `from` æ–¹æ³•ï¼Œå› ä¸º `String` **å­˜å‚¨åœ¨å †ä¸Šæ˜¯åŠ¨æ€çš„**ï¼Œä½ å¯ä»¥è¿™æ ·ä¿®æ”¹å®ƒï¼š
>
>   ```rust
>   let mut s = String::from("hello");
>   s.push_str(", world!"); 	// push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼
>   println!("{}", s); 			// å°†æ‰“å° `hello, world!`
>   ```
>
> - è¨€å½’æ­£ä¼ ï¼Œäº†è§£ `String` å†…å®¹åï¼Œä¸€èµ·æ¥çœ‹çœ‹å…³äºæ‰€æœ‰æƒçš„äº¤äº’ã€‚



#### å˜é‡ç»‘å®šèƒŒåçš„æ•°æ®äº¤äº’

##### è½¬ç§»æ‰€æœ‰æƒ

- å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š

  ```rust
  let x = 5;
  let y = x;
  ```

  è¿™æ®µä»£ç èƒŒåçš„é€»è¾‘æ˜¯ï¼šå°†å­—é¢é‡ `5` ç»‘å®šåˆ°å˜é‡ `x` ä¸Šï¼Œæ¥ç€æŠŠ `x` çš„å€¼æ‹·è´ä¸€ä»½èµ‹å€¼ç»™ `y` ï¼Œæœ€ç»ˆ `x` å’Œ `y` éƒ½å°†ç­‰äº `5` ã€‚å› ä¸ºæ•´æ•°æ˜¯ **Rust** åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯é€šè¿‡**è‡ªåŠ¨æ‹·è´**çš„æ–¹å¼æ¥èµ‹å€¼çš„ï¼Œéƒ½è¢«å­˜åœ¨æ ˆä¸­ï¼Œ**å®Œå…¨æ— éœ€åœ¨å †ä¸Šåˆ†é…å†…å­˜**ã€‚

  å®é™…ä¸Šï¼Œè¿™ç§æ ˆä¸Šçš„æ•°æ®è¶³å¤Ÿç®€å•ï¼Œè€Œä¸”æ‹·è´éå¸¸éå¸¸å¿«ï¼Œåªéœ€è¦å¤åˆ¶ä¸€ä¸ªæ•´æ•°å¤§å°ï¼ˆ`i32`ï¼Œ4 ä¸ªå­—èŠ‚ï¼‰çš„å†…å­˜å³å¯ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‹·è´çš„é€Ÿåº¦è¿œæ¯”åœ¨å †ä¸Šåˆ›å»ºå†…å­˜æ¥å¾—å¿«çš„å¤šã€‚å®é™…ä¸Šï¼Œä¸Šä¸€ç« æˆ‘ä»¬è®²åˆ°çš„ **Rust** åŸºæœ¬ç±»å‹éƒ½æ˜¯é€šè¿‡è‡ªåŠ¨æ‹·è´çš„æ–¹å¼æ¥èµ‹å€¼çš„ï¼Œå°±åƒä¸Šé¢ä»£ç ä¸€æ ·ã€‚

- ç„¶åå†æ¥çœ‹ä¸€æ®µä»£ç ï¼š

  ```rust
  let s1 = String::from("hello");
  let s2 = s1;
  ```

  å¯¹äºåŸºæœ¬ç±»å‹ï¼ˆå­˜å‚¨åœ¨æ ˆä¸Šï¼‰ï¼Œ**Rust** ä¼šè‡ªåŠ¨æ‹·è´ï¼Œä½†æ˜¯ `String` ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œè€Œä¸”æ˜¯å­˜å‚¨åœ¨å †ä¸Šçš„ï¼Œå› æ­¤ä¸èƒ½è‡ªåŠ¨æ‹·è´ã€‚å®é™…ä¸Šï¼Œ `String` ç±»å‹æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œç”±**å­˜å‚¨åœ¨æ ˆä¸­çš„å †æŒ‡é’ˆ**ã€**å­—ç¬¦ä¸²é•¿åº¦**ã€**å­—ç¬¦ä¸²å®¹é‡**å…±åŒç»„æˆï¼Œå…¶ä¸­**å †æŒ‡é’ˆ**æ˜¯æœ€é‡è¦çš„ï¼Œå®ƒæŒ‡å‘äº†çœŸå®å­˜å‚¨å­—ç¬¦ä¸²å†…å®¹çš„å †å†…å­˜ï¼Œè‡³äºé•¿åº¦å’Œå®¹é‡ã€‚ï¼ˆå¦‚æœä½ æœ‰ Go è¯­è¨€çš„ç»éªŒï¼Œè¿™é‡Œå°±å¾ˆå¥½ç†è§£ï¼šå®¹é‡æ˜¯å †å†…å­˜åˆ†é…ç©ºé—´çš„å¤§å°ï¼Œé•¿åº¦æ˜¯ç›®å‰å·²ç»ä½¿ç”¨çš„å¤§å°ï¼‰

  æ€»ä¹‹ `String` ç±»å‹æŒ‡å‘äº†ä¸€ä¸ªå †ä¸Šçš„ç©ºé—´ï¼Œè¿™é‡Œå­˜å‚¨ç€å®ƒçš„çœŸå®æ•°æ®ï¼Œä¸‹é¢å¯¹ä¸Šé¢ä»£ç ä¸­çš„ `let s2 = s1` åˆ†æˆä¸¤ç§æƒ…å†µè®¨è®ºï¼š

  1. æ‹·è´ `String` å’Œå­˜å‚¨åœ¨å †ä¸Šçš„å­—èŠ‚æ•°ç»„ å¦‚æœè¯¥è¯­å¥æ˜¯æ‹·è´æ‰€æœ‰æ•°æ®ï¼ˆ**æ·±æ‹·è´**ï¼‰ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯ `String` æœ¬èº«è¿˜æ˜¯åº•å±‚çš„å †ä¸Šæ•°æ®ï¼Œéƒ½ä¼šè¢«å…¨éƒ¨æ‹·è´ï¼Œè¿™å¯¹äºæ€§èƒ½è€Œè¨€ä¼šé€ æˆéå¸¸å¤§çš„å½±å“ï¼›
  2. åªæ‹·è´ `String` æœ¬èº«ï¼Œè¿™æ ·çš„æ‹·è´éå¸¸å¿«ï¼Œå› ä¸ºåœ¨ 64 ä½æœºå™¨ä¸Šå°±æ‹·è´äº† **8å­—èŠ‚çš„æŒ‡é’ˆ** ã€ **8å­—èŠ‚çš„é•¿åº¦** ã€ **8å­—èŠ‚çš„å®¹é‡** ï¼Œæ€»è®¡ 24 å­—èŠ‚ï¼Œä½†æ˜¯å¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰æåˆ°çš„æ‰€æœ‰æƒè§„åˆ™å§ï¼Ÿå…¶ä¸­æœ‰ä¸€æ¡å°±æ˜¯ï¼š**ä¸€ä¸ªå€¼åªå…è®¸æœ‰ä¸€ä¸ªæ‰€æœ‰è€…**ï¼Œè€Œç°åœ¨è¿™ä¸ªå€¼ï¼ˆå †ä¸Šçš„çœŸå®å­—ç¬¦ä¸²æ•°æ®ï¼‰æœ‰äº†ä¸¤ä¸ªæ‰€æœ‰è€…ï¼š`s1` å’Œ `s2`ã€‚

  > å¥½å§ï¼Œå°±å‡å®šä¸€ä¸ªå€¼å¯ä»¥æ‹¥æœ‰ä¸¤ä¸ªæ‰€æœ‰è€…ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

- å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸåï¼Œ**Rust** ä¼šè‡ªåŠ¨è°ƒç”¨ `drop` å‡½æ•°å¹¶æ¸…ç†å˜é‡çš„å †å†…å­˜ã€‚ä¸è¿‡ç”±äºä¸¤ä¸ª `String` å˜é‡æŒ‡å‘äº†åŒä¸€ä½ç½®ã€‚è¿™å°±æœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼šå½“ `s1` å’Œ `s2` ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš **äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble freeï¼‰** çš„é”™è¯¯ï¼Œä¹Ÿæ˜¯ä¹‹å‰æåˆ°è¿‡çš„å†…å­˜å®‰å…¨æ€§ BUG ä¹‹ä¸€ã€‚ä¸¤æ¬¡é‡Šæ”¾ï¼ˆç›¸åŒï¼‰å†…å­˜ä¼šå¯¼è‡´å†…å­˜æ±¡æŸ“ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚

  å› æ­¤ï¼Œ**Rust** è¿™æ ·è§£å†³é—®é¢˜ï¼š**å½“ `s1` èµ‹äºˆ `s2` åï¼ŒRust è®¤ä¸º `s1` ä¸å†æœ‰æ•ˆï¼Œå› æ­¤ä¹Ÿæ— éœ€åœ¨ `s1` ç¦»å¼€ä½œç”¨åŸŸå `drop` ä»»ä½•ä¸œè¥¿ï¼Œè¿™å°±æ˜¯æŠŠæ‰€æœ‰æƒä» `s1` è½¬ç§»ç»™äº† `s2`ï¼Œ`s1` åœ¨è¢«èµ‹äºˆ `s2` åå°±é©¬ä¸Šå¤±æ•ˆäº†**ã€‚

- å†æ¥çœ‹çœ‹ï¼Œåœ¨æ‰€æœ‰æƒè½¬ç§»åå†æ¥ä½¿ç”¨æ—§çš„æ‰€æœ‰è€…ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼š

  ```rust
  let s1 = String::from("hello");
  let s2 = s1;
  println!("{}, world!", s1);
  ```

  ç”±äº Rust ç¦æ­¢ä½ ä½¿ç”¨æ— æ•ˆçš„å¼•ç”¨ï¼Œä½ ä¼šçœ‹åˆ°ä»¥ä¸‹çš„é”™è¯¯ï¼š

  ```shell
  error[E0382]: use of moved value: `s1`
   --> src/main.rs:5:28
    |
  3 |     let s2 = s1;
    |         -- value moved here
  4 |
  5 |     println!("{}, world!", s1);
    |                            ^^ value used here after move
    |
    = note: move occurs because `s1` has type `std::string::String`, which does
    not implement the `Copy` trait
  ```

- å¦‚æœä½ åœ¨å…¶ä»–è¯­è¨€ä¸­å¬è¯´è¿‡æœ¯è¯­ **æµ…æ‹·è´**ï¼ˆ**shallow copy**ï¼‰å’Œ **æ·±æ‹·è´**ï¼ˆ**deep copy**ï¼‰ï¼Œé‚£ä¹ˆæ‹·è´æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸æ‹·è´æ•°æ®å¬èµ·æ¥å°±åƒæµ…æ‹·è´ï¼Œä½†æ˜¯åˆå› ä¸º **Rust** åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡ `s1` æ— æ•ˆäº†ï¼Œå› æ­¤è¿™ä¸ªæ“ä½œè¢«ç§°ä¸º **ç§»åŠ¨**ï¼ˆ**move**ï¼‰ï¼Œè€Œä¸æ˜¯æµ…æ‹·è´ã€‚ä¸Šé¢çš„ä¾‹å­å¯ä»¥è§£è¯»ä¸º `s1` è¢«**ç§»åŠ¨**åˆ°äº† `s2` ä¸­ã€‚é‚£ä¹ˆå…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œç”¨ä¸€å¼ å›¾ç®€å•è¯´æ˜ï¼š

  ![s1 moved to s2](../Images/string_move_copy.jpg)

  è¿™æ ·å°±è§£å†³äº†æˆ‘ä»¬ä¹‹å‰çš„é—®é¢˜ï¼Œ`s1` ä¸å†æŒ‡å‘ä»»ä½•æ•°æ®ï¼Œåªæœ‰ `s2` æ˜¯æœ‰æ•ˆçš„ï¼Œå½“ `s2` ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒå°±ä¼šé‡Šæ”¾å†…å­˜ã€‚ ç›¸ä¿¡æ­¤åˆ»ï¼Œä½ åº”è¯¥æ˜ç™½äº†ï¼Œä¸ºä»€ä¹ˆ Rust ç§°å‘¼ `let a = b` ä¸º**å˜é‡ç»‘å®š**äº†å§ï¼Ÿå†æ¥çœ‹ä¸€æ®µä»£ç ï¼š

  ```rust
  fn main() {
      let x: &str = "hello, world";
      let y = x;
      println!("{},{}", x, y);
  }
  ```

  è¿™æ®µä»£ç å’Œä¹‹å‰çš„ `String` æœ‰ä¸€ä¸ªæœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼šåœ¨ `String` çš„ä¾‹å­ä¸­ `s1` æŒæœ‰äº†é€šè¿‡`String::from("hello")` åˆ›å»ºçš„å€¼çš„æ‰€æœ‰æƒï¼Œè€Œè¿™ä¸ªä¾‹å­ä¸­ï¼Œ`x` åªæ˜¯å¼•ç”¨äº†å­˜å‚¨åœ¨äºŒè¿›åˆ¶ä¸­çš„å­—ç¬¦ä¸² `"hello, world"`ï¼Œå¹¶æ²¡æœ‰æŒæœ‰æ‰€æœ‰æƒã€‚å› æ­¤ `let y = x` ä¸­ï¼Œä»…ä»…æ˜¯å¯¹è¯¥å¼•ç”¨è¿›è¡Œäº†æ‹·è´ï¼Œæ­¤æ—¶ `y` å’Œ `x` éƒ½å¼•ç”¨äº†åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

##### æ·±æ‹·è´ï¼ˆå…‹éš†ï¼‰

- é¦–å…ˆï¼Œ**Rust æ°¸è¿œä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„ â€œæ·±æ‹·è´â€**ã€‚å› æ­¤ï¼Œä»»ä½•**è‡ªåŠ¨**çš„å¤åˆ¶éƒ½ä¸æ˜¯æ·±æ‹·è´ï¼Œå¯ä»¥è¢«è®¤ä¸ºå¯¹è¿è¡Œæ—¶æ€§èƒ½å½±å“è¾ƒå°ã€‚å¦‚æœæˆ‘ä»¬**ç¡®å®**éœ€è¦æ·±åº¦å¤åˆ¶ `String` ä¸­å †ä¸Šçš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ˆä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš `clone` çš„æ–¹æ³•ï¼š

  ```rust
  let s1 = String::from("hello");
  let s2 = s1.clone();
  println!("s1 = {}, s2 = {}", s1, s2);
  ```

  è¿™æ®µä»£ç èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œå› æ­¤è¯´æ˜ `s2` ç¡®å®å®Œæ•´çš„å¤åˆ¶äº† `s1` çš„æ•°æ®ã€‚

> å¦‚æœä»£ç æ€§èƒ½æ— å…³ç´§è¦ï¼Œä¾‹å¦‚**åˆå§‹åŒ–ç¨‹åºæ—¶**ï¼Œæˆ–è€…åœ¨æŸæ®µæ—¶é—´**åªä¼šæ‰§è¡Œä¸€æ¬¡æ—¶**ï¼Œä½ å¯ä»¥ä½¿ç”¨ `clone` æ¥ç®€åŒ–ç¼–ç¨‹ã€‚ä½†æ˜¯å¯¹äº**æ‰§è¡Œè¾ƒä¸ºé¢‘ç¹çš„ä»£ç **ï¼ˆçƒ­ç‚¹è·¯å¾„ï¼‰ï¼Œä½¿ç”¨ `clone` ä¼šæå¤§çš„é™ä½ç¨‹åºæ€§èƒ½ï¼Œéœ€è¦å°å¿ƒä½¿ç”¨ï¼

##### æµ…æ‹·è´ï¼ˆæ‹·è´ï¼‰

- æµ…æ‹·è´åªå‘ç”Ÿåœ¨æ ˆä¸Šï¼Œå› æ­¤æ€§èƒ½å¾ˆé«˜ï¼Œåœ¨æ—¥å¸¸ç¼–ç¨‹ä¸­ï¼Œæµ…æ‹·è´æ— å¤„ä¸åœ¨ã€‚

  ```rust
  let x = 5;
  let y = x;
  println!("x = {}, y = {}", x, y);
  ```

  ä½†è¿™æ®µä»£ç ä¼¼ä¹ä¸æˆ‘ä»¬åˆšåˆšå­¦åˆ°çš„å†…å®¹ç›¸çŸ›ç›¾ï¼šæ²¡æœ‰è°ƒç”¨ `clone`ï¼Œä¸è¿‡ä¾ç„¶å®ç°äº†ç±»ä¼¼æ·±æ‹·è´çš„æ•ˆæœ â€”â€” æ²¡æœ‰æŠ¥æ‰€æœ‰æƒçš„é”™è¯¯ã€‚

  åŸå› æ˜¯åƒæ•´å‹è¿™æ ·çš„åŸºæœ¬ç±»å‹åœ¨ç¼–è¯‘æ—¶æ˜¯å·²çŸ¥å¤§å°çš„ï¼Œä¼šè¢«å­˜å‚¨åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥æ‹·è´å…¶å®é™…çš„å€¼æ˜¯å¿«é€Ÿçš„ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ç†ç”±åœ¨åˆ›å»ºå˜é‡ `y` åä½¿ `x` æ— æ•ˆï¼ˆ`x`ã€`y` éƒ½ä»ç„¶æœ‰æ•ˆï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œè¿™é‡Œæ²¡æœ‰æ·±æµ…æ‹·è´çš„åŒºåˆ«ï¼Œå› æ­¤è¿™é‡Œè°ƒç”¨ `clone` å¹¶ä¸ä¼šä¸é€šå¸¸çš„æµ…æ‹·è´æœ‰ä»€ä¹ˆä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç®¡å®ƒï¼ˆå¯ä»¥ç†è§£æˆåœ¨æ ˆä¸Šåšäº†æ·±æ‹·è´ï¼‰ã€‚

- **Rust** æœ‰ä¸€ä¸ªå«åš `Copy` çš„ç‰¹å¾ï¼Œå¯ä»¥ç”¨åœ¨ç±»ä¼¼æ•´å‹è¿™æ ·åœ¨æ ˆä¸­å­˜å‚¨çš„ç±»å‹ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ‹¥æœ‰ `Copy` ç‰¹å¾ï¼Œä¸€ä¸ªæ—§çš„å˜é‡åœ¨è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ã€‚

  é‚£ä¹ˆä»€ä¹ˆç±»å‹æ˜¯å¯ `Copy` çš„å‘¢ï¼Ÿå¯ä»¥æŸ¥çœ‹ç»™å®šç±»å‹çš„æ–‡æ¡£æ¥ç¡®è®¤ï¼Œä¸è¿‡ä½œä¸ºä¸€ä¸ªé€šç”¨çš„è§„åˆ™ï¼š **ä»»ä½•åŸºæœ¬ç±»å‹çš„ç»„åˆå¯ä»¥ `Copy` ï¼Œä¸éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»å‹æ˜¯å¯ä»¥ `Copy` çš„**ã€‚å¦‚ä¸‹æ˜¯ä¸€äº› `Copy` çš„ç±»å‹ï¼š

  - æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ `u32`ï¼›
  - å¸ƒå°”ç±»å‹ï¼Œ`bool`ï¼Œå®ƒçš„å€¼æ˜¯ `true` å’Œ `false`ï¼›
  - æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ `f64`ï¼›
  - å­—ç¬¦ç±»å‹ï¼Œ`char`ï¼›
  - å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½æ˜¯ `Copy` çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ`(i32, i32)` æ˜¯ `Copy` çš„ï¼Œä½† `(i32, String)` å°±ä¸æ˜¯ï¼›
  - ä¸å¯å˜å¼•ç”¨ `&T` ï¼Œä¾‹å¦‚[è½¬ç§»æ‰€æœ‰æƒ](https://course.rs/basic/ownership/ownership.html#è½¬ç§»æ‰€æœ‰æƒ)ä¸­çš„æœ€åä¸€ä¸ªä¾‹å­ï¼Œ**ä½†æ˜¯æ³¨æ„: å¯å˜å¼•ç”¨ `&mut T` æ˜¯ä¸å¯ä»¥ Copyçš„**ï¼›



#### å‡½æ•°ä¼ å€¼ä¸è¿”å›

- å°†å€¼ä¼ é€’ç»™å‡½æ•°ï¼Œä¸€æ ·ä¼šå‘ç”Ÿ **ç§»åŠ¨**ï¼ˆ `move` ï¼Œå°±åƒæ˜¯ `String` ä¸€æ ·ï¼‰ æˆ–è€… **å¤åˆ¶** ï¼ˆ `copy` ï¼ŒåŸºç¡€ç±»å‹æˆ–è€…å®ç°äº† `Copy` ç‰¹æ€§çš„ï¼‰ï¼Œå°±è·Ÿ `let` è¯­å¥ä¸€æ ·ï¼Œä¸‹é¢çš„ä»£ç å±•ç¤ºäº†æ‰€æœ‰æƒã€ä½œç”¨åŸŸçš„è§„åˆ™ï¼š

  ```rust
  fn main() {
      let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ
      takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                      // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ
      let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ
      makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œ
                                      // ä½† i32 æ˜¯ Copy çš„ï¼Œæ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x
      // println!("{}", s);			// è¿™é‡Œç”±äº s å·²ç»å‘ç”Ÿäº†ç§»åŠ¨è€Œä¸æ˜¯æ‹·è´
      								// æ‰€ä»¥åœ¨è¿™é‡Œå·²ç»ç¦»å¼€äº†å…¶ä½œç”¨åŸŸ
  } // è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
    // æ‰€ä»¥ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ
  
  fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
      println!("{}", some_string);
  } // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾
  
  fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
      println!("{}", some_integer);
  } // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ
  ```

- åŒæ ·çš„ï¼Œå‡½æ•°è¿”å›å€¼ä¹Ÿæœ‰æ‰€æœ‰æƒï¼Œä¾‹å¦‚:

  ```rust
  fn main() {
      let s1 = gives_ownership();         // gives_ownership å°†è¿”å›å€¼
                                          // ç§»ç»™ s1
      let s2 = String::from("hello");     // s2 è¿›å…¥ä½œç”¨åŸŸ
      let s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°
                                          // takes_and_gives_back ä¸­,
                                          // å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3
  } // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ
    // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ
  
  fn gives_ownership() -> String {             // gives_ownership å°†è¿”å›å€¼ç§»åŠ¨ç»™
                                               // è°ƒç”¨å®ƒçš„å‡½æ•°
      let some_string = String::from("hello"); // some_string è¿›å…¥ä½œç”¨åŸŸ.
      some_string                              // è¿”å› some_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
  }
  
  // takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼
  fn takes_and_gives_back(a_string: String) -> String { // a_string è¿›å…¥ä½œç”¨åŸŸ
      a_string  // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
  }
  ```

- æ‰€æœ‰æƒå¾ˆå¼ºå¤§ï¼Œé¿å…äº†å†…å­˜çš„ä¸å®‰å…¨æ€§ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªæ–°éº»çƒ¦ï¼š **æ€»æ˜¯æŠŠä¸€ä¸ªå€¼ä¼ æ¥ä¼ å»æ¥ä½¿ç”¨å®ƒ**ã€‚ ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå¾ˆå¯èƒ½è¿˜è¦ä»è¯¥å‡½æ•°ä¼ å‡ºå»ï¼Œç»“æœå°±æ˜¯è¯­è¨€è¡¨è¾¾å˜å¾—éå¸¸å•°å—¦ï¼Œå¹¸è¿çš„æ˜¯ï¼Œ**Rust** æä¾›äº†æ–°åŠŸèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚



### å¼•ç”¨ä¸å€Ÿç”¨

- ä¸ŠèŠ‚ä¸­æåˆ°ï¼Œå¦‚æœä»…ä»…æ”¯æŒé€šè¿‡è½¬ç§»æ‰€æœ‰æƒçš„æ–¹å¼è·å–ä¸€ä¸ªå€¼ï¼Œé‚£ä¼šè®©ç¨‹åºå˜å¾—å¤æ‚ã€‚ **Rust** èƒ½åƒå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œ**ä½¿ç”¨æŸä¸ªå˜é‡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨**ã€‚Rust é€šè¿‡ **å€Ÿç”¨**ï¼ˆ**Borrowing**ï¼‰ è¿™ä¸ªæ¦‚å¿µæ¥è¾¾æˆä¸Šè¿°çš„ç›®çš„ï¼Œ**è·å–å˜é‡çš„å¼•ç”¨**ï¼Œç§°ä¹‹ä¸º**å€Ÿç”¨**ï¼ˆ**Borrowing**ï¼‰ã€‚æ­£å¦‚ç°å®ç”Ÿæ´»ä¸­ï¼Œå¦‚æœä¸€ä¸ªäººæ‹¥æœ‰æŸæ ·ä¸œè¥¿ï¼Œä½ å¯ä»¥ä»ä»–é‚£é‡Œå€Ÿæ¥ï¼Œå½“ä½¿ç”¨å®Œæ¯•åï¼Œä¹Ÿå¿…é¡»è¦ç‰©å½’åŸä¸»ã€‚



#### å¼•ç”¨å’Œè§£å¼•ç”¨

- å¸¸è§„å¼•ç”¨ï¼ˆ `&` ï¼‰æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼ŒæŒ‡å‘äº†å¯¹è±¡å­˜å‚¨çš„å†…å­˜åœ°å€ã€‚åœ¨ä¸‹é¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `i32` å€¼çš„å¼•ç”¨ `y`ï¼Œç„¶åä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆ `*` ï¼‰æ¥è§£å‡º `y` æ‰€ä½¿ç”¨çš„å€¼:

  ```rust
  fn main() {
      let x = 5;
      let y = &x;
      assert_eq!(5, x);
      assert_eq!(5, *y);
  }
  ```

  å˜é‡ `x` å­˜æ”¾äº†ä¸€ä¸ª `i32` å€¼ `5`ã€‚`y` æ˜¯ `x` çš„ä¸€ä¸ªå¼•ç”¨ã€‚å¯ä»¥æ–­è¨€ `x` ç­‰äº `5`ã€‚ç„¶è€Œï¼Œå¦‚æœå¸Œæœ›å¯¹ `y` çš„å€¼åšå‡ºæ–­è¨€ï¼Œå¿…é¡»ä½¿ç”¨ `*y` æ¥è§£å‡ºå¼•ç”¨æ‰€æŒ‡å‘çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯**è§£å¼•ç”¨**ï¼‰ã€‚ä¸€æ—¦è§£å¼•ç”¨äº† `y`ï¼Œå°±å¯ä»¥è®¿é—® `y` æ‰€æŒ‡å‘çš„æ•´å‹å€¼å¹¶å¯ä»¥ä¸ `5` åšæ¯”è¾ƒã€‚

- ç›¸åå¦‚æœå°è¯•ç¼–å†™ `assert_eq!(5, y);`ï¼Œåˆ™ä¼šå¾—åˆ°å¦‚ä¸‹ç¼–è¯‘é”™è¯¯ï¼š

  ```shell
  error[E0277]: can't compare `{integer}` with `&{integer}`
   --> src/main.rs:6:5
    |
  6 |     assert_eq!(5, y);
    |     ^^^^^^^^^^^^^^^^^ no implementation for `{integer} == &{integer}` // æ— æ³•æ¯”è¾ƒæ•´æ•°ç±»å‹å’Œå¼•ç”¨ç±»å‹
    |
    = help: the trait `std::cmp::PartialEq<&{integer}>` is not implemented for
    `{integer}`
  ```

> ä¸å…è®¸æ¯”è¾ƒæ•´æ•°ä¸å¼•ç”¨ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„ç±»å‹ï¼Œå¿…é¡»ä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦è§£å‡ºå¼•ç”¨æ‰€æŒ‡å‘çš„å€¼ã€‚



#### ä¸å¯å˜å¼•ç”¨

- ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬ç”¨ `s1` çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `calculate_length` å‡½æ•°ï¼Œè€Œä¸æ˜¯æŠŠ `s1` çš„æ‰€æœ‰æƒè½¬ç§»ç»™è¯¥å‡½æ•°ï¼š

  ```rust
  fn main() {
      let s1 = String::from("hello");
      let len = calculate_length(&s1);
      println!("The length of '{}' is {}.", s1, len);
  }
  
  fn calculate_length(s: &String) -> usize {
      s.len()
  }
  ```

  èƒ½æ³¨æ„åˆ°ä¸¤ç‚¹ï¼š

  1. æ— éœ€åƒä¸Šç« ä¸€æ ·ï¼šå…ˆé€šè¿‡å‡½æ•°å‚æ•°ä¼ å…¥æ‰€æœ‰æƒï¼Œç„¶åå†é€šè¿‡å‡½æ•°è¿”å›æ¥ä¼ å‡ºæ‰€æœ‰æƒï¼Œä»£ç æ›´åŠ ç®€æ´ï¼›
  2. `calculate_length` çš„å‚æ•° `s` ç±»å‹ä» `String` å˜ä¸º `&String` ï¼›

- è¿™é‡Œï¼Œ`&` ç¬¦å·å³æ˜¯å¼•ç”¨ï¼Œå®ƒä»¬å…è®¸ä½ ä½¿ç”¨å€¼ï¼Œä½†æ˜¯ä¸è·å–æ‰€æœ‰æƒï¼Œå¦‚å›¾æ‰€ç¤ºï¼š 

  ![&String s pointing at String s1](../Images/pointer_to_string.jpg)

  é€šè¿‡ `&s1` è¯­æ³•ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª**æŒ‡å‘ `s1` çš„å¼•ç”¨**ï¼Œä½†æ˜¯å¹¶ä¸æ‹¥æœ‰å®ƒã€‚å› ä¸ºå¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå€¼ï¼Œå½“å¼•ç”¨ç¦»å¼€ä½œç”¨åŸŸåï¼Œå…¶æŒ‡å‘çš„å€¼ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒã€‚

- åŒç†ï¼Œå‡½æ•° `calculate_length` ä½¿ç”¨ `&` æ¥è¡¨æ˜å‚æ•° `s` çš„ç±»å‹æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼š

  ```rust
  fn calculate_length(s: &String) -> usize { // s æ˜¯å¯¹ String çš„å¼•ç”¨
      s.len()
  } // è¿™é‡Œï¼Œs ç¦»å¼€äº†ä½œç”¨åŸŸã€‚ä½†å› ä¸ºå®ƒå¹¶ä¸æ‹¥æœ‰å¼•ç”¨å€¼çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ
  ```

  å¦‚æœå°è¯•ä¿®æ”¹å€Ÿç”¨çš„å˜é‡å‘¢ï¼Ÿ

  ```rust
  fn main() {
      let s = String::from("hello");
      change(&s);
  }
  
  fn change(some_string: &String) {
      some_string.push_str(", world");
  }
  ```

  å¾ˆé—æ†¾ï¼Œ**å¼•ç”¨ä¹Ÿæ˜¯ä¸å¯å˜çš„**ï¼š

  ```shell
  error[E0596]: cannot borrow `*some_string` as mutable, as it is behind a `&` reference
   --> src/main.rs:8:5
    |
  7 | fn change(some_string: &String) {
    |                        ------- help: consider changing this to be a mutable reference: `&mut String`
                             ------- å¸®åŠ©ï¼šè€ƒè™‘å°†è¯¥å‚æ•°ç±»å‹ä¿®æ”¹ä¸ºå¯å˜çš„å¼•ç”¨: `&mut String`
  8 |     some_string.push_str(", world");
    |     ^^^^^^^^^^^ `some_string` is a `&` reference, so the data it refers to cannot be borrowed as mutable
                       `some_string`æ˜¯ä¸€ä¸ª`&`ç±»å‹çš„å¼•ç”¨ï¼Œå› æ­¤å®ƒæŒ‡å‘çš„æ•°æ®æ— æ³•è¿›è¡Œä¿®æ”¹
  ```



#### å¯å˜å¼•ç”¨

- æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¯å˜å¼•ç”¨æ˜¯ä»€ä¹ˆæ ·çš„ï¼š

  ```rust
  fn main() {
      let mut s = String::from("hello");
      change(&mut s);
  }
  
  fn change(some_string: &mut String) {
      some_string.push_str(", world");
  }
  ```

  é¦–å…ˆï¼Œå£°æ˜ `s` æ˜¯å¯å˜ç±»å‹ï¼Œå…¶æ¬¡åˆ›å»ºä¸€ä¸ªå¯å˜çš„å¼•ç”¨ `&mut s` å’Œæ¥å—å¯å˜å¼•ç”¨å‚æ•° `some_string: &mut String` çš„å‡½æ•°ã€‚

##### å¯å˜å¼•ç”¨åŒæ—¶åªèƒ½å­˜åœ¨ä¸€ä¸ª

- ä¸è¿‡å¯å˜å¼•ç”¨å¹¶ä¸æ˜¯éšå¿ƒæ‰€æ¬²ã€æƒ³ç”¨å°±ç”¨çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼š **åŒä¸€ä½œç”¨åŸŸï¼Œç‰¹å®šæ•°æ®åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨**ï¼š

  ```rust
  let mut s = String::from("hello");
  let r1 = &mut s;
  let r2 = &mut s;
  println!("{}, {}", r1, r2);
  ```

  ä»¥ä¸Šä»£ç ä¼šæŠ¥é”™ï¼Œè¿™æ®µä»£ç å‡ºé”™çš„åŸå› åœ¨äºï¼Œç¬¬ä¸€ä¸ªå¯å˜å€Ÿç”¨ `r1` å¿…é¡»è¦æŒç»­åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨çš„ä½ç½® `println!`ï¼Œåœ¨ `r1` åˆ›å»ºå’Œæœ€åä¸€æ¬¡ä½¿ç”¨ä¹‹é—´ï¼Œæˆ‘ä»¬åˆå°è¯•åˆ›å»ºç¬¬äºŒä¸ªå¯å˜å¼•ç”¨ `r2`ï¼š

  ```console
  error[E0499]: cannot borrow `s` as mutable more than once at a time åŒä¸€æ—¶é—´æ— æ³•å¯¹ `s` è¿›è¡Œä¸¤æ¬¡å¯å˜å€Ÿç”¨
   --> src/main.rs:5:14
    |
  4 |     let r1 = &mut s;
    |              ------ first mutable borrow occurs here é¦–ä¸ªå¯å˜å¼•ç”¨åœ¨è¿™é‡Œå€Ÿç”¨
  5 |     let r2 = &mut s;
    |              ^^^^^^ second mutable borrow occurs here ç¬¬äºŒä¸ªå¯å˜å¼•ç”¨åœ¨è¿™é‡Œå€Ÿç”¨
  6 |
  7 |     println!("{}, {}", r1, r2);
    |                        -- first borrow later used here ç¬¬ä¸€ä¸ªå€Ÿç”¨åœ¨è¿™é‡Œä½¿ç”¨
  ```

- å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œè¿™ä¸ªç‰¹æ€§ç»å¯¹æ˜¯ä¸€å¤§æ‹¦è·¯è™ï¼Œä¹Ÿæ˜¯æ–°äººä»¬è°ˆä¹‹è‰²å˜çš„ç¼–è¯‘å™¨ `borrow checker` ç‰¹æ€§ä¹‹ä¸€ï¼Œä¸è¿‡å„è¡Œå„ä¸šéƒ½ä¸€æ ·ï¼Œé™åˆ¶å¾€å¾€æ˜¯å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼Œ**Rust** ä¹Ÿä¸€æ ·ã€‚è¿™ç§é™åˆ¶çš„å¥½å¤„å°±æ˜¯ä½¿ **Rust** åœ¨ç¼–è¯‘æœŸå°±é¿å…æ•°æ®ç«äº‰ï¼Œæ•°æ®ç«äº‰å¯ç”±ä»¥ä¸‹è¡Œä¸ºé€ æˆï¼š

  - ä¸¤ä¸ªæˆ–æ›´å¤šçš„æŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®ï¼›
  - è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®ï¼›
  - æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶ï¼›

- æ•°æ®ç«äº‰ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºå¾ˆå¯èƒ½è¶…å‡ºæˆ‘ä»¬çš„é¢„æœŸï¼Œéš¾ä»¥åœ¨è¿è¡Œæ—¶è¿½è¸ªï¼Œå¹¶ä¸”éš¾ä»¥è¯Šæ–­å’Œä¿®å¤ã€‚è€Œ **Rust** é¿å…äº†è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œå› ä¸ºå®ƒç”šè‡³ä¸ä¼šç¼–è¯‘å­˜åœ¨æ•°æ®ç«äº‰çš„ä»£ç ï¼

  å¾ˆå¤šæ—¶å€™ï¼Œå¤§æ‹¬å·å¯ä»¥å¸®æˆ‘ä»¬è§£å†³ä¸€äº›ç¼–è¯‘ä¸é€šè¿‡çš„é—®é¢˜ï¼Œé€šè¿‡æ‰‹åŠ¨é™åˆ¶å˜é‡çš„ä½œç”¨åŸŸï¼š

  ```rust
  let mut s = String::from("hello");
  {
      let r1 = &mut s;
  } // r1 åœ¨è¿™é‡Œç¦»å¼€äº†ä½œç”¨åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨
  let r2 = &mut s;
  ```

##### å¯å˜å¼•ç”¨ä¸ä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨

- ä¸‹é¢çš„ä»£ç ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯ï¼š

  ```rust
  let mut s = String::from("hello");
  let r1 = &s; // æ²¡é—®é¢˜
  let r2 = &s; // æ²¡é—®é¢˜
  let r3 = &mut s; // å¤§é—®é¢˜
  println!("{}, {}, and {}", r1, r2, r3);
  ```

  å…¶å®è¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ­£åœ¨å€Ÿç”¨ä¸å¯å˜å¼•ç”¨çš„ç”¨æˆ·ï¼Œè‚¯å®šä¸å¸Œæœ›ä»–å€Ÿç”¨çš„ä¸œè¥¿ï¼Œè¢«å¦å¤–ä¸€ä¸ªäººè«åå…¶å¦™æ”¹å˜äº†ã€‚å¤šä¸ªä¸å¯å˜å€Ÿç”¨è¢«å…è®¸æ˜¯å› ä¸ºæ²¡æœ‰äººä¼šå»è¯•å›¾ä¿®æ”¹æ•°æ®ï¼Œæ¯ä¸ªäººéƒ½åªè¯»è¿™ä¸€ä»½æ•°æ®è€Œä¸åšä¿®æ”¹ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒæ•°æ®è¢«æ±¡æŸ“ã€‚é”™è¯¯å¦‚ä¸‹ï¼š

  ```shell
  error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
          // æ— æ³•å€Ÿç”¨å¯å˜ `s` å› ä¸ºå®ƒå·²ç»è¢«å€Ÿç”¨äº†ä¸å¯å˜
   --> src/main.rs:6:14
    |
  4 |     let r1 = &s; // æ²¡é—®é¢˜
    |              -- immutable borrow occurs here ä¸å¯å˜å€Ÿç”¨å‘ç”Ÿåœ¨è¿™é‡Œ
  5 |     let r2 = &s; // æ²¡é—®é¢˜
  6 |     let r3 = &mut s; // å¤§é—®é¢˜
    |              ^^^^^^ mutable borrow occurs here å¯å˜å€Ÿç”¨å‘ç”Ÿåœ¨è¿™é‡Œ
  7 |
  8 |     println!("{}, {}, and {}", r1, r2, r3);
    |                                -- immutable borrow later used here ä¸å¯å˜å€Ÿç”¨åœ¨è¿™é‡Œä½¿ç”¨
  ```

> æ³¨æ„ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸ `s` ä»åˆ›å»ºå¼€å§‹ï¼Œ**ä¸€ç›´æŒç»­åˆ°å®ƒæœ€åä¸€æ¬¡ä½¿ç”¨çš„åœ°æ–¹**ï¼Œè¿™ä¸ªè·Ÿå˜é‡çš„ä½œç”¨åŸŸæœ‰æ‰€ä¸åŒï¼Œå˜é‡çš„ä½œç”¨åŸŸä»åˆ›å»ºæŒç»­åˆ°æŸä¸€ä¸ªèŠ±æ‹¬å· `}`

- **Rust** çš„ç¼–è¯‘å™¨ä¸€ç›´åœ¨ä¼˜åŒ–ï¼Œæ—©æœŸçš„æ—¶å€™ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸè·Ÿå˜é‡ä½œç”¨åŸŸæ˜¯ä¸€è‡´çš„ï¼Œè¿™å¯¹æ—¥å¸¸ä½¿ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„å›°æ‰°ï¼Œä½ å¿…é¡»éå¸¸å°å¿ƒçš„å»å®‰æ’å¯å˜ã€ä¸å¯å˜å˜é‡çš„å€Ÿç”¨ï¼Œå…å¾—æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š

  ```rust
  fn main() {
     let mut s = String::from("hello");
      let r1 = &s;
      let r2 = &s;
      println!("{} and {}", r1, r2);
      // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr1,r2ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
      let r3 = &mut s;
      println!("{}", r3);
  } // è€ç¼–è¯‘å™¨ä¸­ï¼Œr1ã€r2ã€r3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
    // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
  ```

  åœ¨è€ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ä¸­ï¼ˆRust 1.31 å‰ï¼‰ï¼Œå°†ä¼šæŠ¥é”™ï¼Œå› ä¸º `r1` å’Œ `r2` çš„ä½œç”¨åŸŸåœ¨èŠ±æ‹¬å· `}` å¤„ç»“æŸï¼Œé‚£ä¹ˆ `r3` çš„å€Ÿç”¨å°±ä¼šè§¦å‘ **æ— æ³•åŒæ—¶å€Ÿç”¨å¯å˜å’Œä¸å¯å˜**çš„è§„åˆ™ã€‚

  ä½†æ˜¯åœ¨æ–°çš„ç¼–è¯‘å™¨ä¸­ï¼Œè¯¥ä»£ç å°†é¡ºåˆ©é€šè¿‡ï¼Œå› ä¸º **å¼•ç”¨ä½œç”¨åŸŸçš„ç»“æŸä½ç½®ä»èŠ±æ‹¬å·å˜æˆæœ€åä¸€æ¬¡ä½¿ç”¨çš„ä½ç½®**ï¼Œå› æ­¤ `r1` å€Ÿç”¨å’Œ `r2` å€Ÿç”¨åœ¨ `println!` åï¼Œå°±ç»“æŸäº†ï¼Œæ­¤æ—¶ `r3` å¯ä»¥é¡ºåˆ©å€Ÿç”¨åˆ°å¯å˜å¼•ç”¨ã€‚

##### NLL

- å¯¹äºè¿™ç§ç¼–è¯‘å™¨ä¼˜åŒ–è¡Œä¸ºï¼Œ**Rust** ä¸“é—¨èµ·äº†ä¸€ä¸ªåå­— â€”â€” **Non-Lexical Lifetimes(NLL)**ï¼Œä¸“é—¨ç”¨äºæ‰¾åˆ°æŸä¸ªå¼•ç”¨åœ¨ä½œç”¨åŸŸï¼ˆ `}` ï¼‰ç»“æŸå‰å°±ä¸å†è¢«ä½¿ç”¨çš„ä»£ç ä½ç½®ã€‚

  è™½ç„¶è¿™ç§å€Ÿç”¨é”™è¯¯æœ‰çš„æ—¶å€™ä¼šè®©æˆ‘ä»¬å¾ˆéƒé—·ï¼Œä½†æ˜¯ä½ åªè¦æƒ³æƒ³è¿™æ˜¯ **Rust** æå‰å¸®ä½ å‘ç°äº†æ½œåœ¨çš„ BUGï¼Œå…¶å®å°±å¼€å¿ƒäº†ï¼Œè™½ç„¶å‡æ…¢äº†å¼€å‘é€Ÿåº¦ï¼Œä½†æ˜¯ä»é•¿æœŸæ¥çœ‹ï¼Œå¤§å¹…å‡å°‘äº†åç»­å¼€å‘å’Œè¿ç»´æˆæœ¬ã€‚



#### æ‚¬å‚å¼•ç”¨ï¼ˆDangling Referenceï¼‰

- æ‚¬å‚å¼•ç”¨ä¹Ÿå«åšæ‚¬å‚æŒ‡é’ˆï¼Œæ„æ€ä¸ºæŒ‡é’ˆæŒ‡å‘æŸä¸ªå€¼åï¼Œè¿™ä¸ªå€¼è¢«é‡Šæ”¾æ‰äº†ï¼Œè€ŒæŒ‡é’ˆä»ç„¶å­˜åœ¨ï¼Œå…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½ä¸å­˜åœ¨ä»»ä½•å€¼æˆ–å·²è¢«å…¶å®ƒå˜é‡é‡æ–°ä½¿ç”¨ã€‚åœ¨ **Rust** ä¸­ç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿å¼•ç”¨æ°¸è¿œä¹Ÿä¸ä¼šå˜æˆæ‚¬å‚çŠ¶æ€ï¼šå½“ä½ æ‹¥æœ‰ä¸€äº›æ•°æ®çš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿æ•°æ®ä¸ä¼šåœ¨å…¶å¼•ç”¨ä¹‹å‰è¢«é‡Šæ”¾ï¼Œè¦æƒ³é‡Šæ”¾æ•°æ®ï¼Œå¿…é¡»å…ˆåœæ­¢å…¶å¼•ç”¨çš„ä½¿ç”¨ã€‚

  è®©æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼Œ**Rust** ä¼šæŠ›å‡ºä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ï¼š

  ```rust
  fn main() {
      let reference_to_nothing = dangle();
  }
  
  fn dangle() -> &String { // dangle è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼•ç”¨
      let s = String::from("hello"); // s æ˜¯ä¸€ä¸ªæ–°å­—ç¬¦ä¸²
      &s // è¿”å›å­—ç¬¦ä¸² s çš„å¼•ç”¨
  } // è¿™é‡Œ s ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚å…¶å†…å­˜è¢«é‡Šæ”¾ã€‚
    // å±é™©ï¼
  ```

  é”™è¯¯å¦‚ä¸‹ï¼Œå› ä¸º `s` æ˜¯åœ¨ `dangle` å‡½æ•°å†…åˆ›å»ºçš„ï¼Œå½“ `dangle` çš„ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œ`s` å°†è¢«é‡Šæ”¾, ä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬åˆå°è¯•å»è¿”å›å®ƒçš„å¼•ç”¨ã€‚è¿™æ„å‘³ç€è¿™ä¸ªå¼•ç”¨ä¼šæŒ‡å‘ä¸€ä¸ªæ— æ•ˆçš„ `String`ï¼Œè¿™å¯ä¸å¯¹ï¼

  ```rust
  error[E0106]: missing lifetime specifier
   --> src/main.rs:5:16
    |
  5 | fn dangle() -> &String {
    |                ^ expected named lifetime parameter
    |
    = help: this function's return type contains a borrowed value, but there is no value for it to be borrowed from
    = å¸®åŠ©ï¼šè¯¥å‡½æ•°è¿”å›äº†ä¸€ä¸ªå€Ÿç”¨çš„å€¼ï¼Œä½†æ˜¯å·²ç»æ‰¾ä¸åˆ°å®ƒæ‰€å€Ÿç”¨å€¼çš„æ¥æº
  help: consider using the `'static` lifetime
    |
  5 | fn dangle() -> &'static String {
    |                ~~~~~~~~
  ```

  å…¶ä¸­ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ³•æ˜¯ç›´æ¥è¿”å› `String`ï¼š

  ```rust
  fn no_dangle() -> String {
      let s = String::from("hello");
      s
  }
  ```

  è¿™æ ·å°±æ²¡æœ‰ä»»ä½•é”™è¯¯äº†ï¼Œæœ€ç»ˆ `String` çš„ **æ‰€æœ‰æƒè¢«è½¬ç§»ç»™å¤–é¢çš„è°ƒç”¨è€…**ã€‚

