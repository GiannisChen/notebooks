## ç‰¹å¾ï¼ˆTraitsï¼‰

- æœ‰æ—¶å€™ç¨‹åºå‘˜éœ€è¦æ ¹æ®è¦è¿›è¡Œå¤šç§åº•å±‚å®ç°ï¼Œä½†æ˜¯è‡³äºè¦ä¸€ä¸ªä¸Šå±‚æŠ½è±¡æ¥å£ï¼Œå°±è·Ÿ Java ä¸­çš„æ¥å£ç±»å‹ä¸€æ ·æˆ–è€…ç±»ä¼¼ï¼Œéœ€è¦æŠŠè¿™äº›è¡Œä¸ºæŠ½è±¡å‡ºæ¥ï¼Œ **Rust** ä¸­çš„ç‰¹å¾ `trait` æ¦‚å¿µå°±æ˜¯åº”å¯¹è¿™ç§éœ€æ±‚çš„ã€‚

  åœ¨ä¹‹å‰çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¤šæ¬¡è§è¿‡ç‰¹å¾çš„ä½¿ç”¨ï¼Œä¾‹å¦‚ `#[derive(Debug)]`ï¼Œå®ƒåœ¨æˆ‘ä»¬å®šä¹‰çš„ç±»å‹ï¼ˆ`struct`ï¼‰ä¸Šè‡ªåŠ¨æ´¾ç”Ÿ `Debug` ç‰¹å¾ï¼Œæ¥ç€å¯ä»¥ä½¿ç”¨ `println!("{:?}", x)` æ‰“å°è¿™ä¸ªç±»å‹ï¼›å†ä¾‹å¦‚ï¼š

  ```rust
  fn add<T: std::ops::Add<Output = T>>(a:T, b:T) -> T { a + b }
  ```

  é€šè¿‡ `std::ops::Add` ç‰¹å¾æ¥é™åˆ¶ `T`ï¼Œåªæœ‰ `T` å®ç°äº† `std::ops::Add` æ‰èƒ½è¿›è¡Œåˆæ³•çš„åŠ æ³•æ“ä½œï¼Œæ¯•ç«Ÿä¸æ˜¯æ‰€æœ‰çš„ç±»å‹éƒ½èƒ½è¿›è¡Œç›¸åŠ ã€‚

> è¿™äº›éƒ½è¯´æ˜ä¸€ä¸ªé“ç†ï¼Œç‰¹å¾å®šä¹‰äº†**ä¸€ä¸ªå¯ä»¥è¢«å…±äº«çš„è¡Œä¸ºï¼Œåªè¦å®ç°äº†ç‰¹å¾ï¼Œä½ å°±èƒ½ä½¿ç”¨è¯¥è¡Œä¸º**ã€‚



### å®šä¹‰ç‰¹å¾

- å¦‚æœä¸åŒçš„ç±»å‹å…·æœ‰ç›¸åŒçš„è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªç‰¹å¾ï¼Œç„¶åä¸ºè¿™äº›ç±»å‹å®ç°è¯¥ç‰¹å¾ã€‚**å®šä¹‰ç‰¹å¾**æ˜¯æŠŠä¸€äº›æ–¹æ³•ç»„åˆåœ¨ä¸€èµ·ï¼Œç›®çš„æ˜¯å®šä¹‰ä¸€ä¸ªå®ç°æŸäº›ç›®æ ‡æ‰€å¿…éœ€çš„è¡Œä¸ºçš„é›†åˆã€‚

  ä¾‹å¦‚ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰æ–‡ç«  `Post` å’Œå¾®åš `Weibo` ä¸¤ç§å¯¹å¹³å°ç”¨æˆ·è¿›è¡Œæ‘˜è¦æ¨é€ï¼Œä¹Ÿå°±æ˜¯æ— è®ºæ˜¯æ–‡ç« å†…å®¹ï¼Œè¿˜æ˜¯å¾®åšå†…å®¹ï¼Œéƒ½åªéœ€è¦ä½œè€…ç­‰å°‘é‡ä¿¡æ¯ç”Ÿæˆæ¨é€ä¿¡æ¯ï¼Œé‚£ä¹ˆæ€»ç»“æ¨é€ä¿¡æ¯è¿™ä¸ªè¡Œä¸ºå°±æ˜¯å…±äº«çš„ï¼Œå› æ­¤å¯ä»¥ç”¨ç‰¹å¾æ¥å®šä¹‰ï¼š

  ```rust
  pub trait Summary {
      fn summarize(&self) -> String;
  }
  ```

  - è¿™é‡Œä½¿ç”¨ `trait` å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªç‰¹å¾ï¼Œ`Summary` æ˜¯ç‰¹å¾åã€‚åœ¨å¤§æ‹¬å·ä¸­å®šä¹‰äº†è¯¥ç‰¹å¾çš„æ‰€æœ‰æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ï¼š `fn summarize(&self) -> String` ã€‚
  - ç‰¹å¾åªå®šä¹‰è¡Œä¸ºçœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè€Œä¸å®šä¹‰è¡Œä¸ºå…·ä½“æ˜¯æ€ä¹ˆæ ·çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªå®šä¹‰ç‰¹å¾æ–¹æ³•çš„ç­¾åï¼Œè€Œä¸è¿›è¡Œå®ç°ï¼Œæ­¤æ—¶æ–¹æ³•ç­¾åç»“å°¾æ˜¯ `;`ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª `{}`ã€‚

- æ¥ä¸‹æ¥ï¼Œæ¯ä¸€ä¸ªå®ç°è¿™ä¸ªç‰¹å¾çš„ç±»å‹éƒ½éœ€è¦å…·ä½“å®ç°è¯¥ç‰¹å¾çš„ç›¸åº”æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šç¡®ä¿ä»»ä½•å®ç° `Summary` ç‰¹å¾çš„ç±»å‹éƒ½æ‹¥æœ‰ä¸è¿™ä¸ªç­¾åçš„å®šä¹‰å®Œå…¨ä¸€è‡´çš„ `summarize` æ–¹æ³•ã€‚



### ä¸ºç±»å‹å®ç°ç‰¹å¾

- å› ä¸ºç‰¹å¾åªå®šä¹‰è¡Œä¸ºçœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸ºç±»å‹å®ç°å…·ä½“çš„ç‰¹å¾ï¼Œå®šä¹‰è¡Œä¸ºå…·ä½“æ˜¯æ€ä¹ˆæ ·çš„ã€‚

- é¦–å…ˆæ¥ä¸º `Post` å’Œ `Weibo` å®ç° `Summary` ç‰¹å¾ï¼š

  ```rust
  pub trait Summary {
      fn summarize(&self) -> String;
  }
  pub struct Post {
      pub title: String, // æ ‡é¢˜
      pub author: String, // ä½œè€…
      pub content: String, // å†…å®¹
  }
  
  impl Summary for Post {
      fn summarize(&self) -> String {
          format!("æ–‡ç« {}, ä½œè€…æ˜¯{}", self.title, self.author)
      }
  }
  
  pub struct Weibo {
      pub username: String,
      pub content: String
  }
  
  impl Summary for Weibo {
      fn summarize(&self) -> String {
          format!("{}å‘è¡¨äº†å¾®åš{}", self.username, self.content)
      }
  }
  ```

  ```rust
  fn main() {
      let post = Post{title: "Rustè¯­è¨€ç®€ä»‹".to_string(),author: "Sunface".to_string(), content: "Rustæ£’æäº†!".to_string()};
      let weibo = Weibo{username: "sunface".to_string(),content: "å¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨".to_string()};
  
      println!("{}",post.summarize());
      println!("{}",weibo.summarize());
  }
  ```



##### ç‰¹å¾å®šä¹‰ä¸å®ç°ä½ç½®ï¼ˆå­¤å„¿è§„åˆ™ï¼‰

- ä¸Šé¢æˆ‘ä»¬å°† `Summary` å®šä¹‰æˆäº† `pub` å…¬å¼€çš„ã€‚è¿™æ ·ï¼Œå¦‚æœä»–äººæƒ³è¦ä½¿ç”¨æˆ‘ä»¬çš„ `Summary` ç‰¹å¾ï¼Œåˆ™å¯ä»¥å¼•å…¥åˆ°ä»–ä»¬çš„åŒ…ä¸­ï¼Œç„¶åå†è¿›è¡Œå®ç°ã€‚

- å…³äºç‰¹å¾å®ç°ä¸å®šä¹‰çš„ä½ç½®ï¼Œæœ‰ä¸€æ¡éå¸¸é‡è¦çš„åŸåˆ™ï¼š**å¦‚æœä½ æƒ³è¦ä¸ºç±»å‹ `A` å®ç°ç‰¹å¾ `T`ï¼Œé‚£ä¹ˆ `A` æˆ–è€… `T` è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯åœ¨å½“å‰ä½œç”¨åŸŸä¸­å®šä¹‰çš„ï¼**ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä¸ºä¸Šé¢çš„ `Post` ç±»å‹å®ç°æ ‡å‡†åº“ä¸­çš„ `Display` ç‰¹å¾ï¼Œè¿™æ˜¯å› ä¸º `Post` ç±»å‹å®šä¹‰åœ¨å½“å‰çš„ä½œç”¨åŸŸä¸­ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å½“å‰åŒ…ä¸­ä¸º `String` ç±»å‹å®ç° `Summary` ç‰¹å¾ï¼Œå› ä¸º `Summary` å®šä¹‰åœ¨å½“å‰ä½œç”¨åŸŸä¸­ã€‚

  ä½†æ˜¯ä½ æ— æ³•åœ¨å½“å‰ä½œç”¨åŸŸä¸­ï¼Œä¸º `String` ç±»å‹å®ç° `Display` ç‰¹å¾ï¼Œå› ä¸ºå®ƒä»¬ä¿©éƒ½å®šä¹‰åœ¨æ ‡å‡†åº“ä¸­ï¼Œå…¶å®šä¹‰æ‰€åœ¨çš„ä½ç½®éƒ½ä¸åœ¨å½“å‰ä½œç”¨åŸŸï¼Œè·Ÿä½ åŠæ¯›é’±å…³ç³»éƒ½æ²¡æœ‰ï¼Œçœ‹çœ‹å°±è¡Œäº†ã€‚

  è¯¥è§„åˆ™è¢«ç§°ä¸º**å­¤å„¿è§„åˆ™**ï¼Œå¯ä»¥ç¡®ä¿å…¶å®ƒäººç¼–å†™çš„ä»£ç ä¸ä¼šç ´åä½ çš„ä»£ç ï¼Œä¹Ÿç¡®ä¿äº†ä½ ä¸ä¼šè«åå…¶å¦™å°±ç ´åäº†é£é©¬ç‰›ä¸ç›¸åŠçš„ä»£ç ã€‚

##### é»˜è®¤å®ç°

- ä½ å¯ä»¥åœ¨ç‰¹å¾ä¸­å®šä¹‰å…·æœ‰**é»˜è®¤å®ç°**çš„æ–¹æ³•ï¼Œè¿™æ ·å…¶å®ƒç±»å‹æ— éœ€å†å®ç°è¯¥æ–¹æ³•ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€‰æ‹©é‡è½½è¯¥æ–¹æ³•ï¼š

  ```rust
  pub trait Summary {
      fn summarize(&self) -> String {
          String::from("(Read more...)")
      }
  }
  ```

  ä¸Šé¢ä¸º `Summary` å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤å®ç°ï¼Œä¸‹é¢æˆ‘ä»¬ç¼–å†™æ®µä»£ç æ¥æµ‹è¯•ä¸‹ï¼š

  ```rust
  impl Summary for Post {}
  
  impl Summary for Weibo {
      fn summarize(&self) -> String {
          format!("{}å‘è¡¨äº†å¾®åš{}", self.username, self.content)
      }
  }
  // (Read more...)
  // sunfaceå‘è¡¨äº†å¾®åšå¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨
  ```

- é»˜è®¤å®ç°å…è®¸è°ƒç”¨ç›¸åŒç‰¹å¾ä¸­çš„å…¶ä»–æ–¹æ³•ï¼Œå“ªæ€•è¿™äº›æ–¹æ³•æ²¡æœ‰é»˜è®¤å®ç°ã€‚å¦‚æ­¤ï¼Œç‰¹å¾å¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½è€Œåªéœ€è¦å®ç°æŒ‡å®šçš„ä¸€å°éƒ¨åˆ†å†…å®¹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ `Summary` ç‰¹å¾ï¼Œä½¿å…¶å…·æœ‰ä¸€ä¸ªéœ€è¦å®ç°çš„ `summarize_author` æ–¹æ³•ï¼Œç„¶åå®šä¹‰ä¸€ä¸ª `summarize` æ–¹æ³•ï¼Œæ­¤æ–¹æ³•çš„é»˜è®¤å®ç°è°ƒç”¨ `summarize_author` æ–¹æ³•ï¼š

  ```rust
  pub trait Summary {
      fn summarize_author(&self) -> String;
  
      fn summarize(&self) -> String {
          format!("(Read more from {}...)", self.summarize_author())
      }
  }
  ```

  ä¸ºäº†ä½¿ç”¨ `Summary`ï¼Œåªéœ€è¦å®ç° `summarize_author` æ–¹æ³•å³å¯ï¼š

  ```rust
  impl Summary for Weibo {
      fn summarize_author(&self) -> String {
          format!("@{}", self.username)
      }
  }
  println!("1 new weibo: {}", weibo.summarize());
  ```

  `weibo.summarize()` ä¼šå…ˆè°ƒç”¨ `Summary` ç‰¹å¾é»˜è®¤å®ç°çš„ `summarize` æ–¹æ³•ï¼Œé€šè¿‡è¯¥æ–¹æ³•è¿›è€Œè°ƒç”¨ `Weibo` ä¸º `Summary` å®ç°çš„ `summarize_author` æ–¹æ³•ï¼Œæœ€ç»ˆè¾“å‡ºï¼š`1 new weibo: (Read more from @horse_ebooks...)`ã€‚



### ä½¿ç”¨ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°

- ç°åœ¨ï¼Œå…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°ï¼š

  ```rust
  pub fn notify(item: &impl Summary) {
      println!("Breaking news! {}", item.summarize());
  }
  ```

  `impl Summary`ï¼Œåªèƒ½è¯´æƒ³å‡ºè¿™ä¸ªç±»å‹çš„äººçœŸçš„æ˜¯èµ·åé¬¼æ‰ï¼Œç®€ç›´å¤ªè´´åˆ‡äº†ï¼Œæ•…åæ€ä¹‰ï¼Œå®ƒçš„æ„æ€æ˜¯ **å®ç°äº†`Summary`ç‰¹å¾** çš„ `item` å‚æ•°ã€‚

  ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•å®ç°äº† `Summary` ç‰¹å¾çš„ç±»å‹ä½œä¸ºè¯¥å‡½æ•°çš„å‚æ•°ï¼ŒåŒæ—¶åœ¨å‡½æ•°ä½“å†…ï¼Œè¿˜å¯ä»¥è°ƒç”¨è¯¥ç‰¹å¾çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `summarize` æ–¹æ³•ã€‚å…·ä½“çš„è¯´ï¼Œå¯ä»¥ä¼ é€’ `Post` æˆ– `Weibo` çš„å®ä¾‹æ¥ä½œä¸ºå‚æ•°ï¼Œè€Œå…¶å®ƒç±»å¦‚ `String` æˆ–è€… `i32` çš„ç±»å‹åˆ™ä¸èƒ½ç”¨åšè¯¥å‡½æ•°çš„å‚æ•°ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å®ç° `Summary` ç‰¹å¾ã€‚

  ä½†æ˜¯å‘¢ï¼Œè¿™åªæ˜¯ä¸€ä¸ª**è¯­æ³•ç³–**ï¼Œå…¶å®å°±æ˜¯ä¸€ç§**å—çº¦æŸçš„æ³›å‹**ï¼š

  ```rust
  pub fn notify<T: Summary>(item: &T) {
      println!("Breaking news! {}", item.summarize());
  }
  ```



### ç‰¹å¾çº¦æŸï¼ˆTrait Boundï¼‰

- æ­£å¦‚ä¸ŠèŠ‚æ‰€è¯´ï¼Œè™½ç„¶ `impl Trait` è¿™ç§è¯­æ³•éå¸¸å¥½ç†è§£ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚

  åœ¨ç®€å•çš„åœºæ™¯ä¸‹ `impl Trait` è¿™ç§è¯­æ³•ç³–å°±è¶³å¤Ÿä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºå¤æ‚çš„åœºæ™¯ï¼Œç‰¹å¾çº¦æŸå¯ä»¥è®©æˆ‘ä»¬æ‹¥æœ‰æ›´å¤§çš„çµæ´»æ€§å’Œè¯­æ³•è¡¨ç°èƒ½åŠ›ï¼Œä¾‹å¦‚ä¸€ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ª `impl Summary` çš„å‚æ•°ï¼š

  ```rust
  pub fn notify(item1: &impl Summary, item2: &impl Summary) {}
  ```

  å¦‚æœå‡½æ•°ä¸¤ä¸ªå‚æ•°æ˜¯ä¸åŒçš„ç±»å‹ï¼Œé‚£ä¹ˆä¸Šé¢çš„æ–¹æ³•å¾ˆå¥½ï¼Œåªè¦è¿™ä¸¤ä¸ªç±»å‹éƒ½å®ç°äº† `Summary` ç‰¹å¾å³å¯ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦å¼ºåˆ¶å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°æ˜¯åŒä¸€ç±»å‹å‘¢ï¼Ÿä¸Šé¢çš„è¯­æ³•å°±æ— æ³•åšåˆ°è¿™ç§é™åˆ¶ï¼Œæ­¤æ—¶æˆ‘ä»¬åªèƒ½ä½¿**ç‰¹å¾çº¦æŸ**æ¥å®ç°ï¼š

  ```rust
  pub fn notify<T: Summary>(item1: &T, item2: &T) {}
  ```

  æ³›å‹ç±»å‹ `T` è¯´æ˜äº† `item1` å’Œ `item2` å¿…é¡»æ‹¥æœ‰åŒæ ·çš„ç±»å‹ï¼ŒåŒæ—¶ `T: Summary` è¯´æ˜äº† `T` å¿…é¡»å®ç° `Summary` ç‰¹å¾ã€‚

##### å¤šé‡çº¦æŸ

- é™¤äº†å•ä¸ªçº¦æŸæ¡ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šå¤šä¸ªçº¦æŸæ¡ä»¶ï¼Œä¾‹å¦‚é™¤äº†è®©å‚æ•°å®ç° `Summary` ç‰¹å¾å¤–ï¼Œè¿˜å¯ä»¥è®©å‚æ•°å®ç° `Display` ç‰¹å¾ä»¥æ§åˆ¶å®ƒçš„æ ¼å¼åŒ–è¾“å‡ºï¼š

  ```rust
  pub fn notify(item: &(impl Summary + Display)) {}
  ```

  é™¤äº†ä¸Šè¿°çš„è¯­æ³•ç³–å½¢å¼ï¼Œè¿˜èƒ½ä½¿ç”¨**ç‰¹å¾çº¦æŸ**çš„å½¢å¼ï¼š

  ```rust
  pub fn notify<T: Summary + Display>(item: &T) {}
  ```

  é€šè¿‡è¿™ä¸¤ä¸ªç‰¹å¾ï¼Œå°±å¯ä»¥ä½¿ç”¨ `item.summarize` æ–¹æ³•ï¼Œä»¥åŠé€šè¿‡ `println!("{}", item)` æ¥æ ¼å¼åŒ–è¾“å‡º `item`ã€‚

##### where çº¦æŸ

- å½“ç‰¹å¾çº¦æŸå˜å¾—å¾ˆå¤šæ—¶ï¼Œå‡½æ•°çš„ç­¾åå°†å˜å¾—å¾ˆå¤æ‚ï¼š

  ```rust
  fn some_function<T: Display + Clone, U: Clone + Debug>(t: &T, u: &U) -> i32 {}
  ```

  ä¸¥æ ¼æ¥è¯´ï¼Œä¸Šé¢çš„ä¾‹å­è¿˜æ˜¯ä¸å¤Ÿå¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯èƒ½å¯¹å…¶åšä¸€äº›å½¢å¼ä¸Šçš„æ”¹è¿›ï¼Œé€šè¿‡ `where`ï¼š

  ```rust
  fn some_function<T, U>(t: &T, u: &U) -> i32
      where T: Display + Clone,
            U: Clone + Debug
  {}
  ```

##### ä½¿ç”¨ç‰¹å¾çº¦æŸæœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•æˆ–ç‰¹å¾

- ç‰¹å¾çº¦æŸï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨æŒ‡å®šç±»å‹ + æŒ‡å®šç‰¹å¾çš„æ¡ä»¶ä¸‹å»å®ç°æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š

  ```rust
  use std::fmt::Display;
  
  struct Pair<T> { x: T, y: T, }
  
  impl<T> Pair<T> {
      fn new(x: T, y: T) -> Self {
          Self { x, y, }
      }
  }
  
  impl<T: Display + PartialOrd> Pair<T> {
      fn cmp_display(&self) {
          if self.x >= self.y {
              println!("The largest member is x = {}", self.x);
          } else {
              println!("The largest member is y = {}", self.y);
          }
      }
  }
  ```

  `cmp_display` æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ `Pair<T>` ç»“æ„ä½“å¯¹è±¡éƒ½å¯ä»¥æ‹¥æœ‰ï¼Œåªæœ‰ `T` åŒæ—¶å®ç°äº† `Display + PartialOrd` çš„ `Pair<T>` æ‰å¯ä»¥æ‹¥æœ‰æ­¤æ–¹æ³•ã€‚ è¯¥å‡½æ•°å¯è¯»æ€§ä¼šæ›´å¥½ï¼Œå› ä¸ºæ³›å‹å‚æ•°ã€å‚æ•°ã€è¿”å›å€¼éƒ½åœ¨ä¸€èµ·ï¼Œå¯ä»¥å¿«é€Ÿçš„é˜…è¯»ï¼ŒåŒæ—¶æ¯ä¸ªæ³›å‹å‚æ•°çš„ç‰¹å¾ä¹Ÿåœ¨æ–°çš„ä»£ç è¡Œä¸­é€šè¿‡**ç‰¹å¾çº¦æŸ**è¿›è¡Œäº†çº¦æŸã€‚

- **ä¹Ÿå¯ä»¥æœ‰æ¡ä»¶åœ°å®ç°ç‰¹å¾**, ä¾‹å¦‚ï¼Œæ ‡å‡†åº“ä¸ºä»»ä½•å®ç°äº† `Display` ç‰¹å¾çš„ç±»å‹å®ç°äº† `ToString` ç‰¹å¾ï¼š

  ```rust
  /// A trait for converting a value to a `String`.
  ///
  /// This trait is automatically implemented for any type which implements the
  /// [`Display`] trait. As such, `ToString` shouldn't be implemented directly:
  /// [`Display`] should be implemented instead, and you get the `ToString`
  /// implementation for free.
  ///
  /// [`Display`]: fmt::Display
  #[cfg_attr(not(test), rustc_diagnostic_item = "ToString")]
  #[stable(feature = "rust1", since = "1.0.0")]
  pub trait ToString {
      /// Converts the given value to a `String`.
      ///
      /// # Examples
      ///
      /// Basic usage:
      ///
      /// ```
      /// let i = 5;
      /// let five = String::from("5");
      ///
      /// assert_eq!(five, i.to_string());
      /// ```
      #[rustc_conversion_suggestion]
      #[stable(feature = "rust1", since = "1.0.0")]
      fn to_string(&self) -> String;
  }
  ```

  ```rust
  /// # Panics
  ///
  /// In this implementation, the `to_string` method panics
  /// if the `Display` implementation returns an error.
  /// This indicates an incorrect `Display` implementation
  /// since `fmt::Write for String` never returns an error itself.
  #[cfg(not(no_global_oom_handling))]
  #[stable(feature = "rust1", since = "1.0.0")]
  impl<T: fmt::Display + ?Sized> ToString for T {
      // A common guideline is to not inline generic functions. However,
      // removing `#[inline]` from this method causes non-negligible regressions.
      // See <https://github.com/rust-lang/rust/pull/74852>, the last attempt
      // to try to remove it.
      #[inline]
      default fn to_string(&self) -> String {
          let mut buf = String::new();
          let mut formatter = core::fmt::Formatter::new(&mut buf);
          // Bypass format_args!() to avoid write_str with zero-length strs
          fmt::Display::fmt(self, &mut formatter)
              .expect("a Display implementation returned an error unexpectedly");
          buf
      }
  }
  ```

  æˆ‘ä»¬å¯ä»¥å¯¹ä»»ä½•å®ç°äº† `Display` ç‰¹å¾çš„ç±»å‹è°ƒç”¨ç”± `ToString` å®šä¹‰çš„ `to_string` æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†æ•´å‹è½¬æ¢ä¸ºå¯¹åº”çš„ `String` å€¼ï¼Œå› ä¸ºæ•´å‹å®ç°äº† `Display`ï¼š

  ```rust
  let s = 3.to_string();
  ```



### å‡½æ•°è¿”å›ä¸­åœ° impl Trait

- å¯ä»¥é€šè¿‡ `impl Trait` æ¥è¯´æ˜ä¸€ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ª**å®ç°äº†æŸä¸ªç‰¹å¾çš„ç±»å‹**ï¼š

  ```rust
  fn returns_summarizable() -> impl Summary {
      Weibo {
          username: String::from("sunface"),
          content: String::from(
              "m1 maxå¤ªå‰å®³äº†ï¼Œç”µè„‘å†ä¹Ÿä¸ä¼šå¡",
          )
      }
  }
  ```

  å› ä¸º `Weibo` å®ç°äº† `Summary`ï¼Œå› æ­¤è¿™é‡Œå¯ä»¥ç”¨å®ƒæ¥ä½œä¸ºè¿”å›å€¼ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶æˆ‘ä»¬çŸ¥é“è¿™é‡Œæ˜¯ä¸€ä¸ª `Weibo` ç±»å‹ï¼Œä½†æ˜¯å¯¹äº `returns_summarizable` çš„è°ƒç”¨è€…è€Œè¨€ï¼Œä»–åªçŸ¥é“è¿”å›äº†ä¸€ä¸ªå®ç°äº† `Summary` ç‰¹å¾çš„å¯¹è±¡ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“è¿”å›äº†ä¸€ä¸ª `Weibo` ç±»å‹ã€‚

  è¿™ç§ `impl Trait` å½¢å¼çš„è¿”å›å€¼ï¼Œåœ¨ä¸€ç§åœºæ™¯ä¸‹éå¸¸éå¸¸æœ‰ç”¨ï¼Œé‚£å°±æ˜¯è¿”å›çš„çœŸå®ç±»å‹éå¸¸å¤æ‚ï¼Œä½ ä¸çŸ¥é“è¯¥æ€ä¹ˆå£°æ˜æ—¶ï¼ˆæ¯•ç«Ÿ **Rust** è¦æ±‚ä½ å¿…é¡»æ ‡å‡ºæ‰€æœ‰çš„ç±»å‹ï¼‰ï¼Œæ­¤æ—¶å°±å¯ä»¥ç”¨ `impl Trait` çš„æ–¹å¼ç®€å•è¿”å›ã€‚ä¾‹å¦‚ï¼Œé—­åŒ…å’Œè¿­ä»£å™¨å°±æ˜¯å¾ˆå¤æ‚ï¼Œåªæœ‰ç¼–è¯‘å™¨æ‰çŸ¥é“é‚£ç©æ„çš„çœŸå®ç±»å‹ï¼Œå¦‚æœè®©ä½ å†™å‡ºæ¥å®ƒä»¬çš„å…·ä½“ç±»å‹ï¼Œä¼°è®¡å†…å¿ƒæœ‰ä¸€ä¸‡åªè‰æ³¥é©¬å¥”è…¾ï¼Œå¥½åœ¨ä½ å¯ä»¥ç”¨ `impl Iterator` æ¥å‘Šè¯‰è°ƒç”¨è€…ï¼Œè¿”å›äº†ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå› ä¸ºæ‰€æœ‰è¿­ä»£å™¨éƒ½ä¼šå®ç° `Iterator` ç‰¹å¾ã€‚

  ä½†æ˜¯è¿™ç§è¿”å›å€¼æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ â€”â€” åªèƒ½æœ‰ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š

  ```rust
  fn returns_summarizable(switch: bool) -> impl Summary {
      if switch {
          Post {
              title: String::from(
                  "Penguins win the Stanley Cup Championship!",
              ),
              author: String::from("Iceburgh"),
              content: String::from(
                  "The Pittsburgh Penguins once again are the best \
                   hockey team in the NHL.",
              ),
          }
      } else {
          Weibo {
              username: String::from("horse_ebooks"),
              content: String::from(
                  "of course, as you probably already know, people",
              ),
          }
      }
  }
  ```

  ä»¥ä¸Šçš„ä»£ç å°±æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºå®ƒè¿”å›äº†ä¸¤ä¸ªä¸åŒçš„ç±»å‹ `Post` å’Œ `Weibo`ã€‚

  ```shell
  `if` and `else` have incompatible types
  expected struct `Post`, found struct `Weibo`
  ```



### ä¿®å¤ä¸Šä¸€èŠ‚ä¸­çš„ `largest` å‡½æ•°

- **æ³›å‹**ï¼ˆ**Generics**ï¼‰ä¸€ç« ä¸­ç•™æœ‰ä¸€ä¸ªæœªè§£å†³çš„ `largest` å‡½æ•°é—®é¢˜ï¼š

  ```rust
  fn largest<T>(list: &[T]) -> T {
      let mut largest = list[0];
  
      for &item in list.iter() {
          if item > largest {
              largest = item;
          }
      }
  
      largest
  }
  
  fn main() {
      let number_list = vec![34, 50, 25, 100, 65];
  
      let result = largest(&number_list);
      println!("The largest number is {}", result);
  
      let char_list = vec!['y', 'm', 'a', 'q'];
  
      let result = largest(&char_list);
      println!("The largest char is {}", result);
  }
  ```

  ä½†æ˜¯è¿™ä¼šæŠ¥é”™ï¼š

  ```shell
  error[E0369]: binary operation `>` cannot be applied to type `T` // `>`æ“ä½œç¬¦ä¸èƒ½ç”¨äºç±»å‹`T`
   --> src/main.rs:5:17
    |
  5 |         if item > largest {
    |            ---- ^ ------- T
    |            |
    |            T
    |
  help: consider restricting type parameter `T` // è€ƒè™‘å¯¹Tè¿›è¡Œç±»å‹ä¸Šçš„é™åˆ¶ :
    |
  1 | fn largest<T: std::cmp::PartialOrd>(list: &[T]) -> T {
    |             ++++++++++++++++++++++
  ```

  å› ä¸º `T` å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„ç±»å‹éƒ½èƒ½è¿›è¡Œæ¯”è¾ƒï¼Œå› æ­¤ä¸Šé¢çš„é”™è¯¯ä¸­ï¼Œç¼–è¯‘å™¨å»ºè®®æˆ‘ä»¬ç»™ `T` æ·»åŠ ä¸€ä¸ªç±»å‹é™åˆ¶ï¼šä½¿ç”¨ `std::cmp::PartialOrd` ç‰¹å¾ï¼ˆTraitï¼‰å¯¹ `T` è¿›è¡Œé™åˆ¶ã€‚

  åœ¨ `largest` å‡½æ•°ä½“ä¸­æˆ‘ä»¬æƒ³è¦ä½¿ç”¨å¤§äºè¿ç®—ç¬¦ï¼ˆ`>`ï¼‰æ¯”è¾ƒä¸¤ä¸ª `T` ç±»å‹çš„å€¼ã€‚è¿™ä¸ªè¿ç®—ç¬¦æ˜¯æ ‡å‡†åº“ä¸­ç‰¹å¾ `std::cmp::PartialOrd` çš„ä¸€ä¸ªé»˜è®¤æ–¹æ³•ã€‚æ‰€ä»¥éœ€è¦åœ¨ `T` çš„ç‰¹å¾çº¦æŸä¸­æŒ‡å®š `PartialOrd`ï¼Œè¿™æ · `largest` å‡½æ•°å¯ä»¥ç”¨äºå†…éƒ¨å…ƒç´ ç±»å‹å¯æ¯”è¾ƒå¤§å°çš„æ•°ç»„åˆ‡ç‰‡ã€‚

  ç”±äº `PartialOrd` ä½äº `prelude` ä¸­æ‰€ä»¥å¹¶ä¸éœ€è¦é€šè¿‡ `std::cmp` æ‰‹åŠ¨å°†å…¶å¼•å…¥ä½œç”¨åŸŸã€‚æ‰€ä»¥å¯ä»¥å°† `largest` çš„ç­¾åä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š

  ```rust
  fn largest<T: PartialOrd>(list: &[T]) -> T {}
  ```

  ```rust
  fn largest<T>(list: &[T]) -> T
  where
      T: PartialOrd + Copy,
  {
      let mut largest_one = list[0];
      for &one in list.iter() {
          if one > largest_one {
              largest_one = one;
          }
      }
      return largest_one;
  }
  
  fn main() {
      let number_list = vec![34, 50, 25, 100, 65];
  
      let result = largest(&number_list);
      println!("The largest number is {}", result);
  
      let char_list = vec!['y', 'm', 'a', 'q'];
  
      let result = largest(&char_list);
      println!("The largest char is {}", result);
  }
  
  ```

  è¦æ³¨æ„åŒæ—¶éœ€è¦å®ç° `Copy` ç‰¹æ€§ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½æŠŠæ‰€æœ‰æƒè¿›è¡Œè½¬ç§»ï¼Œæ¯•ç«Ÿåªæœ‰ `i32` ç­‰åŸºç¡€ç±»å‹æ‰å®ç°äº† `Copy` ç‰¹æ€§ï¼Œå¯ä»¥å­˜å‚¨åœ¨æ ˆä¸Šï¼Œè€Œ `T` å¯ä»¥æŒ‡ä»£ä»»ä½•ç±»å‹ï¼ˆä¸¥æ ¼æ¥è¯´æ˜¯å®ç°äº† `PartialOrd` ç‰¹å¾çš„æ‰€æœ‰ç±»å‹ï¼‰ã€‚

  å¦‚æœå¹¶ä¸å¸Œæœ›é™åˆ¶ `largest` å‡½æ•°åªèƒ½ç”¨äºå®ç°äº† `Copy` ç‰¹å¾çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `T` çš„ç‰¹å¾çº¦æŸä¸­æŒ‡å®š [`Clone` ç‰¹å¾](https://course.rs/basic/ownership/ownership.html#å…‹éš†æ·±æ‹·è´) è€Œä¸æ˜¯ `Copy` ç‰¹å¾ã€‚å¹¶å…‹éš† `list` ä¸­çš„æ¯ä¸€ä¸ªå€¼ä½¿å¾— `largest` å‡½æ•°æ‹¥æœ‰å…¶æ‰€æœ‰æƒã€‚ä½¿ç”¨ `clone` å‡½æ•°æ„å‘³ç€å¯¹äºç±»ä¼¼ `String` è¿™æ ·æ‹¥æœ‰å †ä¸Šæ•°æ®çš„ç±»å‹ï¼Œä¼šæ½œåœ¨åœ°åˆ†é…æ›´å¤šå †ä¸Šç©ºé—´ï¼Œè€Œå †åˆ†é…åœ¨æ¶‰åŠå¤§é‡æ•°æ®æ—¶å¯èƒ½ä¼šç›¸å½“ç¼“æ…¢ã€‚

- å¦ä¸€ç§ `largest` çš„å®ç°æ–¹å¼æ˜¯è¿”å›åœ¨ `list` ä¸­ `T` å€¼çš„å¼•ç”¨ã€‚å¦‚æœæˆ‘ä»¬å°†å‡½æ•°è¿”å›å€¼ä» `T` æ”¹ä¸º `&T` å¹¶æ”¹å˜å‡½æ•°ä½“ä½¿å…¶èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œæˆ‘ä»¬å°†ä¸éœ€è¦ä»»ä½• `Clone` æˆ– `Copy` çš„ç‰¹å¾çº¦æŸè€Œä¸”ä¹Ÿä¸ä¼šæœ‰ä»»ä½•çš„å †åˆ†é…ï¼š

  ```rust
  fn largest<T>(list: &[T]) -> &T
  where
      T: PartialOrd,
  {
      let mut largest_one = &list[0];
      for one in list.iter() {
          if *one > *largest_one {
              largest_one = one;
          }
      }
      return largest_one;
  }
  ```



### é€šè¿‡ derive æ´¾ç”Ÿç‰¹å¾

- å½¢å¦‚ `#[derive(Debug)]` çš„ä»£ç å·²ç»å‡ºç°äº†å¾ˆå¤šæ¬¡ï¼Œè¿™ç§æ˜¯ä¸€ç§ç‰¹å¾æ´¾ç”Ÿè¯­æ³•ï¼Œè¢« `derive` æ ‡è®°çš„å¯¹è±¡ä¼šè‡ªåŠ¨å®ç°å¯¹åº”çš„é»˜è®¤ç‰¹å¾ä»£ç ï¼Œç»§æ‰¿ç›¸åº”çš„åŠŸèƒ½ã€‚
  1. `Debug` ç‰¹å¾ â€”â€” å®ƒæœ‰ä¸€å¥—è‡ªåŠ¨å®ç°çš„é»˜è®¤ä»£ç ï¼Œå½“ä½ ç»™ä¸€ä¸ªç»“æ„ä½“æ ‡è®°åï¼Œå°±å¯ä»¥ä½¿ç”¨ `println!("{:?}", s)` çš„å½¢å¼æ‰“å°è¯¥ç»“æ„ä½“çš„å¯¹è±¡ã€‚
  2. `Copy` ç‰¹å¾ â€”â€” å®ƒä¹Ÿæœ‰ä¸€å¥—è‡ªåŠ¨å®ç°çš„é»˜è®¤ä»£ç ï¼Œå½“æ ‡è®°åˆ°ä¸€ä¸ªç±»å‹ä¸Šæ—¶ï¼Œå¯ä»¥è®©è¿™ä¸ªç±»å‹è‡ªåŠ¨å®ç° `Copy` ç‰¹å¾ï¼Œè¿›è€Œå¯ä»¥è°ƒç”¨ `copy` æ–¹æ³•ï¼Œè¿›è¡Œè‡ªæˆ‘å¤åˆ¶ã€‚
- æ€»ä¹‹ï¼Œ`derive` æ´¾ç”Ÿå‡ºæ¥çš„æ˜¯ **Rust** é»˜è®¤ç»™æˆ‘ä»¬æä¾›çš„ç‰¹å¾ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­æå¤§çš„ç®€åŒ–äº†è‡ªå·±æ‰‹åŠ¨å®ç°ç›¸åº”ç‰¹å¾çš„éœ€æ±‚ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œè¿˜å¯ä»¥è‡ªå·±æ‰‹åŠ¨é‡è½½è¯¥å®ç°ã€‚
- è¯¦ç»†çš„ `derive` åˆ—è¡¨å‚è§[é™„å½•-æ´¾ç”Ÿç‰¹å¾](https://course.rs/appendix/derive.html)ã€‚



### å‡ ä¸ªç»¼åˆä¾‹å­

##### è‡ªå®šä¹‰ç±»å‹ + æ“ä½œ

- åœ¨ Rust ä¸­é™¤äº†æ•°å€¼ç±»å‹çš„åŠ æ³•ï¼Œ`String` ä¹Ÿå¯ä»¥åš[åŠ æ³•](https://course.rs/basic/compound-type/string-slice.html#æ“ä½œå­—ç¬¦ä¸²)ï¼Œå› ä¸º Rust ä¸ºè¯¥ç±»å‹å®ç°äº† `std::ops::Add` ç‰¹å¾ï¼ŒåŒç†ï¼Œå¦‚æœæˆ‘ä»¬ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç°äº†è¯¥ç‰¹å¾ï¼Œé‚£å°±å¯ä»¥è‡ªå·±å®ç° `Point1 + Point2` çš„æ“ä½œï¼š

  ```rust
  use std::ops::Add;
  
  // ä¸ºPointç»“æ„ä½“æ´¾ç”ŸDebugç‰¹å¾ï¼Œç”¨äºæ ¼å¼åŒ–è¾“å‡º
  #[derive(Debug)]
  struct Point<T: Add<T, Output = T>> {
      //é™åˆ¶ç±»å‹Tå¿…é¡»å®ç°äº†Addç‰¹å¾ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œ+æ“ä½œã€‚
      x: T,
      y: T,
  }
  
  impl<T: Add<T, Output = T>> Add for Point<T> {
      type Output = Point<T>;
  
      fn add(self, p: Point<T>) -> Point<T> {
          Point {
              x: self.x + p.x,
              y: self.y + p.y,
          }
      }
  }
  
  fn main() {
      let p1 = Point {
          x: 1.1f32,
          y: 1.1f32,
      };
      let p2 = Point {
          x: 2.1f32,
          y: 2.1f32,
      };
      println!("{:?}", p1 + p2);
  
      let p3 = Point { x: 1i32, y: 1i32 };
      let p4 = Point { x: 2i32, y: 2i32 };
      println!("{:?}", p3 + p4);
  }
  ```



##### è‡ªå®šä¹‰ç±»å‹çš„æ‰“å°è¾“å‡º

- åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€åªè¦ä½¿ç”¨ `#[derive(Debug)]` å¯¹æˆ‘ä»¬çš„è‡ªå®šä¹‰ç±»å‹è¿›è¡Œæ ‡æ³¨ï¼Œå³å¯å®ç°æ‰“å°è¾“å‡ºçš„åŠŸèƒ½ğŸ‘†ã€‚ä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹æˆ‘ä»¬çš„è‡ªå®šä¹‰ç±»å‹è¿›è¡Œè‡ªå®šä¹‰çš„æ ¼å¼åŒ–è¾“å‡ºï¼Œä»¥è®©ç”¨æˆ·æ›´å¥½çš„é˜…è¯»ç†è§£æˆ‘ä»¬çš„ç±»å‹ï¼Œæ­¤æ—¶å°±è¦ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç° `std::fmt::Display` ç‰¹å¾ğŸ‘‡ï¼š

  ```rust
  use std::fmt::Display;
  use std::ops::Add;
  
  // ä¸ºPointç»“æ„ä½“æ´¾ç”ŸDebugç‰¹å¾ï¼Œç”¨äºæ ¼å¼åŒ–è¾“å‡º
  #[derive(Debug)]
  struct Point<T>
  where
      T: Add<T, Output = T> + Display,
  {
      //é™åˆ¶ç±»å‹Tå¿…é¡»å®ç°äº†Addç‰¹å¾ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œ+æ“ä½œã€‚
      x: T,
      y: T,
  }
  
  impl<T> Add for Point<T>
  where
      T: Add<T, Output = T> + Display,
  {
      type Output = Point<T>;
      fn add(self, p: Point<T>) -> Point<T> {
          Point {
              x: self.x + p.x,
              y: self.y + p.y,
          }
      }
  }
  
  impl<T> Display for Point<T>
  where
      T: Add<T, Output = T> + Display,
  {
      fn fmt(&self, f: &mut std::fmt::Formatter) -> std::fmt::Result {
          write!(f, "({},{})", self.x, self.y)
      }
  }
  
  fn main() {
      let p1 = Point {
          x: 1.1f32,
          y: 1.1f32,
      };
      let p2 = Point {
          x: 2.1f32,
          y: 2.1f32,
      };
      println!("{}", p1 + p2);
  
      let p3 = Point { x: 1i32, y: 1i32 };
      let p4 = Point { x: 2i32, y: 2i32 };
      println!("{}", p3 + p4);
  }
  ```



### ç‰¹å¾å¯¹è±¡

- åœ¨ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å¸Œæœ›è¿”å›çš„ç±»å‹æ˜¯å®ç°æŸç§ç‰¹å¾çš„ï¼Œä½†æ˜¯è¿™ä¸€æ®µä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š

  ```rust
  fn returns_summarizable(switch: bool) -> impl Summary {
      if switch {
          Post { /* ... */ }
      } else {
          Weibo { /* ... */ }
      }
  }
  ```

  æˆ‘æœ´ç´ çš„æƒ³æ³•æ˜¯ï¼Œå¥—ä¸ªæšä¸¾ï¼š

  ```rust
  #[derive(Debug)]
  enum Enum {
      Post,
      Weibo,
  }
  ```

  ä½†æ˜¯æ˜¾ç„¶è¿˜æ˜¯ä¸å¤Ÿçµæ´»ï¼Œéœ€è¦è¿”å›çš„ç»“æ„ä½“ç±»å‹å¯èƒ½æœªçŸ¥ï¼Œæˆ‘åªéœ€è¦ä»–æœ‰ä¸€ä¸ªæˆ‘éœ€è¦çš„æ–¹æ³•å³å¯ã€‚ä½†æ˜¯ Rust æ²¡æœ‰ Go çš„ `interface` ä¹Ÿæ²¡æœ‰å…¶ä»–è¯­è¨€çš„çˆ¶ç±»åŸºç±»ï¼Œæ‰€ä»¥ï¼Œ **Rust** å¼•å…¥äº†ç‰¹å¾å¯¹è±¡çš„æ¦‚å¿µæ¥è¾¾åˆ°ä¸Šé¢è¿™å‡ ç§å®ç°æ–¹å¼ç›¸åŒçš„æ•ˆæœã€‚

##### ç‰¹å¾å¯¹è±¡å®šä¹‰

- ä¸ºäº†è§£å†³ä¸Šé¢çš„æ‰€æœ‰é—®é¢˜ï¼ŒRust å¼•å…¥äº†ä¸€ä¸ªæ¦‚å¿µ â€”â€” **ç‰¹å¾å¯¹è±¡**ã€‚

  åœ¨ä»‹ç»ç‰¹å¾å¯¹è±¡ä¹‹å‰ï¼Œå…ˆæ¥ä¸ºä¹‹å‰çš„ `Weibo` å’Œ `Post` å®šä¹‰ä¸€ä¸ªç‰¹å¾ï¼Œå¹¶å®ç°è¿™ä¸ªç‰¹æ€§ï¼ˆç•¥ï¼‰ï¼š

  ```rust
  pub trait Summary {
      fn summarize(&self) -> String;
  }
  ```

  ç°åœ¨å°±è¦è€ƒè™‘æ€ä¹ˆè¿”å›ä¸€ä¸ªé€šç”¨çš„ç±»å‹ï¼ŒåŒæ—¶ä»–èƒ½è°ƒç”¨æˆ‘çš„ `summarize()` å‡½æ•°ã€‚**Rust** æä¾›äº†å®ç°ç‰¹å¾çš„å¯¹è±¡ä½œä¸ºç±»å‹ï¼Œå³**ç‰¹å¾å¯¹è±¡** â€”â€” å¯ä»¥é€šè¿‡ `&` å¼•ç”¨æˆ–è€… `Box<T>` æ™ºèƒ½æŒ‡é’ˆçš„æ–¹å¼æ¥åˆ›å»ºç‰¹å¾å¯¹è±¡ï¼Œè¯¥ **ç‰¹å¾å¯¹è±¡** æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ˜ å°„å…³ç³»ï¼ŒæŒ‡å‘äº†å®ç°æŸç§ç‰¹å¾çš„ç±»å‹çš„å®ä¾‹ï¼Œè¿™ç§æ˜ å°„å…³ç³»æ˜¯å­˜å‚¨åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶**é€šè¿‡ç‰¹å¾å¯¹è±¡æ‰¾åˆ°å…·ä½“è°ƒç”¨çš„ç±»å‹æ–¹æ³•**ï¼š

  ```rust
  pub trait Summary {
      fn summarize(&self) -> String;
  }
  pub struct Post {
      pub title: String,   // æ ‡é¢˜
      pub author: String,  // ä½œè€…
      pub content: String, // å†…å®¹
  }
  
  impl Summary for Post {
      fn summarize(&self) -> String {
          format!("æ–‡ç« {}, ä½œè€…æ˜¯{}", self.title, self.author)
      }
  }
  
  pub struct Weibo {
      pub username: String,
      pub content: String,
  }
  
  impl Summary for Weibo {
      fn summarize(&self) -> String {
          format!("{}å‘è¡¨äº†å¾®åš{}", self.username, self.content)
      }
  }
  
  fn returns_summarizable(switch: bool) -> Box<dyn Summary> {
      if switch {
          return Box::new(Post {
              title: "Rustè¯­è¨€ç®€ä»‹".to_string(),
              author: "Sunface".to_string(),
              content: "Rustæ£’æäº†!".to_string(),
          });
      } else {
          return Box::new(Weibo {
              username: "sunface".to_string(),
              content: "å¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨".to_string(),
          });
      }
  }
  
  fn main() {
      let vec = vec![returns_summarizable(true), returns_summarizable(false)];
  
      for i in vec.iter() {
          println!("{}", i.summarize());
      }
  }
  ```

  > `Box<T>` åœ¨åé¢ç« èŠ‚ä¼š[è¯¦ç»†è®²è§£](https://course.rs/advance/smart-pointer/box.html)ï¼Œå¤§å®¶ç°åœ¨æŠŠå®ƒå½“æˆä¸€ä¸ªå¼•ç”¨å³å¯ï¼Œåªä¸è¿‡å®ƒåŒ…è£¹çš„å€¼ä¼šè¢«å¼ºåˆ¶åˆ†é…åœ¨å †ä¸Šã€‚

  > åœ¨åŠ¨æ€ç±»å‹è¯­è¨€ä¸­ï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼š**é¸­å­ç±»å‹**ï¼ˆ**duck typing**ï¼‰ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åªå…³å¿ƒå€¼é•¿å•¥æ ·ï¼Œè€Œä¸å…³å¿ƒå®ƒå®é™…æ˜¯ä»€ä¹ˆã€‚å½“ä¸€ä¸ªä¸œè¥¿èµ°èµ·æ¥åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€åªé¸­å­ï¼Œå°±ç®—å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¥¥ç‰¹æ›¼ï¼Œä¹Ÿä¸é‡è¦ï¼Œæˆ‘ä»¬å°±å½“å®ƒæ˜¯é¸­å­ã€‚
  >
  > ä½¿ç”¨ç‰¹å¾å¯¹è±¡å’Œ **Rust** ç±»å‹ç³»ç»Ÿæ¥è¿›è¡Œç±»ä¼¼é¸­å­ç±»å‹æ“ä½œçš„ä¼˜åŠ¿æ˜¯ï¼Œæ— éœ€åœ¨è¿è¡Œæ—¶æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦å®ç°äº†ç‰¹å®šæ–¹æ³•æˆ–è€…æ‹…å¿ƒåœ¨è°ƒç”¨æ—¶å› ä¸ºå€¼æ²¡æœ‰å®ç°æ–¹æ³•è€Œäº§ç”Ÿé”™è¯¯ã€‚**å¦‚æœå€¼æ²¡æœ‰å®ç°ç‰¹å¾å¯¹è±¡æ‰€éœ€çš„ç‰¹å¾ï¼Œ é‚£ä¹ˆ Rust æ ¹æœ¬å°±ä¸ä¼šç¼–è¯‘è¿™äº›ä»£ç **ã€‚

- æ³¨æ„ `dyn` ä¸èƒ½å•ç‹¬ä½œä¸ºç‰¹å¾å¯¹è±¡çš„å®šä¹‰ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç‰¹å¾å¯¹è±¡å¯ä»¥æ˜¯ä»»æ„å®ç°äº†æŸä¸ªç‰¹å¾çš„ç±»å‹ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸä¸çŸ¥é“è¯¥ç±»å‹çš„å¤§å°ï¼Œä¸åŒçš„ç±»å‹å¤§å°æ˜¯ä¸åŒçš„ï¼š

  ```rust
  fn draw2(x: dyn Draw) {
      x.draw();
  }
  ```

  ```shell
  10 | fn draw2(x: dyn Draw) {
     |          ^ doesn't have a size known at compile-time
     |
     = help: the trait `Sized` is not implemented for `(dyn Draw + 'static)`
  help: function arguments must have a statically known size, borrowed types always have a known size
  ```

  è€Œ `&dyn` å’Œ `Box<dyn>` åœ¨ç¼–è¯‘æœŸéƒ½æ˜¯å·²çŸ¥å¤§å°ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä½œç‰¹å¾å¯¹è±¡çš„å®šä¹‰ã€‚



##### ç‰¹å¾å¯¹è±¡çš„åŠ¨æ€åˆ†å‘

- **Rust** å­˜åœ¨ä¸¤ç§ä¸åŒçš„åˆ†å‘æ¨¡å¼ï¼š

  1. å›å¿†ä¸€ä¸‹æ³›å‹ç« èŠ‚æˆ‘ä»¬æåˆ°è¿‡çš„ï¼Œæ³›å‹æ˜¯åœ¨ç¼–è¯‘æœŸå®Œæˆå¤„ç†çš„ï¼šç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸€ä¸ªæ³›å‹å‚æ•°å¯¹åº”çš„å…·ä½“ç±»å‹ç”Ÿæˆä¸€ä»½ä»£ç ï¼Œè¿™ç§æ–¹å¼æ˜¯**é™æ€åˆ†å‘**ï¼ˆ**static dispatch**ï¼‰ï¼Œå› ä¸ºæ˜¯åœ¨ç¼–è¯‘æœŸå®Œæˆçš„ï¼Œå¯¹äºè¿è¡ŒæœŸæ€§èƒ½å®Œå…¨æ²¡æœ‰ä»»ä½•å½±å“ã€‚
  2. ä¸é™æ€åˆ†å‘ç›¸å¯¹åº”çš„æ˜¯**åŠ¨æ€åˆ†å‘**ï¼ˆ**dynamic dispatch**ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›´åˆ°è¿è¡Œæ—¶ï¼Œæ‰èƒ½ç¡®å®šéœ€è¦è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ã€‚ä¹‹å‰ä»£ç ä¸­çš„å…³é”®å­— `dyn` æ­£æ˜¯åœ¨å¼ºè°ƒè¿™ä¸€â€œåŠ¨æ€â€çš„ç‰¹ç‚¹ã€‚

- å½“ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ—¶ï¼Œ**Rust** å¿…é¡»ä½¿ç”¨åŠ¨æ€åˆ†å‘ã€‚ç¼–è¯‘å™¨æ— æ³•çŸ¥æ™“æ‰€æœ‰å¯èƒ½ç”¨äºç‰¹å¾å¯¹è±¡ä»£ç çš„ç±»å‹ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸çŸ¥é“åº”è¯¥è°ƒç”¨å“ªä¸ªç±»å‹çš„å“ªä¸ªæ–¹æ³•å®ç°ã€‚ä¸ºæ­¤ï¼Œ**Rust** åœ¨è¿è¡Œæ—¶ä½¿ç”¨ç‰¹å¾å¯¹è±¡ä¸­çš„æŒ‡é’ˆæ¥çŸ¥æ™“éœ€è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚åŠ¨æ€åˆ†å‘ä¹Ÿé˜»æ­¢ç¼–è¯‘å™¨æœ‰é€‰æ‹©çš„å†…è”æ–¹æ³•ä»£ç ï¼Œè¿™ä¼šç›¸åº”çš„ç¦ç”¨ä¸€äº›ä¼˜åŒ–ã€‚

  ä¸‹é¢è¿™å¼ å›¾å¾ˆå¥½çš„è§£é‡Šäº†é™æ€åˆ†å‘ `Box<T>` å’ŒåŠ¨æ€åˆ†å‘ `Box<dyn Trait>` çš„åŒºåˆ«ï¼š

  ![img](../Images/trait_object_structure.jpg)

- ç»“åˆä¸Šæ–‡çš„å†…å®¹å’Œè¿™å¼ å›¾å¯ä»¥äº†è§£ï¼š

  - **ç‰¹å¾å¯¹è±¡å¤§å°ä¸å›ºå®š**ï¼šè¿™æ˜¯å› ä¸ºï¼Œå¯¹äºç‰¹å¾ `Summary`ï¼Œç±»å‹ `Post` å¯ä»¥å®ç°ç‰¹å¾ `Summary`ï¼Œç±»å‹ `Weibo` ä¹Ÿå¯ä»¥å®ç°ç‰¹å¾ `Summary`ï¼Œå› æ­¤**ç‰¹å¾æ²¡æœ‰å›ºå®šå¤§å°**ï¼›
  - **å‡ ä¹æ€»æ˜¯ä½¿ç”¨ç‰¹å¾å¯¹è±¡çš„å¼•ç”¨æ–¹å¼**ï¼Œå¦‚ `&dyn Summary` ã€ `Box<dyn Summary>` ï¼š
    1. è™½ç„¶ç‰¹å¾å¯¹è±¡æ²¡æœ‰å›ºå®šå¤§å°ï¼Œä½†å®ƒçš„å¼•ç”¨ç±»å‹çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå®ƒç”±ä¸¤ä¸ªæŒ‡é’ˆç»„æˆï¼ˆ`ptr` å’Œ `vptr`ï¼‰ï¼Œå› æ­¤å ç”¨ä¸¤ä¸ªæŒ‡é’ˆå¤§å°ï¼›
    2. ä¸€ä¸ªæŒ‡é’ˆ `ptr` æŒ‡å‘å®ç°äº†ç‰¹å¾ `Summary` çš„å…·ä½“ç±»å‹çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯å½“ä½œç‰¹å¾ `Summary` æ¥ç”¨çš„ç±»å‹çš„å®ä¾‹ï¼Œæ¯”å¦‚ç±»å‹ `Post` çš„å®ä¾‹ã€ç±»å‹ `Weibo` çš„å®ä¾‹
    3. å¦ä¸€ä¸ªæŒ‡é’ˆ `vptr` æŒ‡å‘ä¸€ä¸ª**è™šè¡¨** `vtable`ï¼Œ`vtable` ä¸­ä¿å­˜äº†ç±»å‹ `Post` æˆ–ç±»å‹ `Weibo` çš„å®ä¾‹å¯¹äºå¯ä»¥è°ƒç”¨çš„å®ç°äºç‰¹å¾ `Summary` çš„æ–¹æ³•ã€‚å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œç›´æ¥ä» `vtable` ä¸­æ‰¾åˆ°æ–¹æ³•å¹¶è°ƒç”¨ã€‚ä¹‹æ‰€ä»¥è¦ä½¿ç”¨ä¸€ä¸ª `vtable` æ¥ä¿å­˜å„å®ä¾‹çš„æ–¹æ³•ï¼Œæ˜¯å› ä¸ºå®ç°äº†ç‰¹å¾ `Summary` çš„ç±»å‹æœ‰å¤šç§ï¼Œè¿™äº›ç±»å‹æ‹¥æœ‰çš„æ–¹æ³•å„ä¸ç›¸åŒï¼Œå½“å°†è¿™äº›ç±»å‹çš„å®ä¾‹éƒ½å½“ä½œç‰¹å¾ `Summary` æ¥ä½¿ç”¨æ—¶ï¼ˆæ­¤æ—¶ï¼Œå®ƒä»¬å…¨éƒ½çœ‹ä½œæ˜¯ç‰¹ `Summary` ç±»å‹çš„å®ä¾‹ï¼‰ï¼Œæœ‰å¿…è¦åŒºåˆ†è¿™äº›å®ä¾‹å„è‡ªæœ‰å“ªäº›æ–¹æ³•å¯è°ƒç”¨ã€‚

- ç®€è€Œè¨€ä¹‹ï¼Œå½“ç±»å‹ `Post` å®ç°äº†ç‰¹å¾ `Summary` æ—¶ï¼Œç±»å‹ `Post` çš„å®ä¾‹å¯¹è±¡ `post` å¯ä»¥å½“ä½œç‰¹å¾ `Summary` çš„ç‰¹å¾å¯¹è±¡ç±»å‹æ¥ä½¿ç”¨ï¼Œ`post` ä¸­ä¿å­˜äº†ä½œä¸ºç‰¹å¾å¯¹è±¡çš„æ•°æ®æŒ‡é’ˆï¼ˆæŒ‡å‘ç±»å‹ `Post` çš„å®ä¾‹æ•°æ®ï¼‰å’Œè¡Œä¸ºæŒ‡é’ˆï¼ˆæŒ‡å‘ `vtable`ï¼‰ã€‚

  ä¸€å®šè¦æ³¨æ„ï¼Œæ­¤æ—¶çš„ `post` æ˜¯ `Post` çš„ç‰¹å¾å¯¹è±¡çš„å®ä¾‹ï¼Œè€Œä¸å†æ˜¯å…·ä½“ç±»å‹ `Button` çš„å®ä¾‹ï¼Œè€Œä¸” `post` çš„ `vtable` åªåŒ…å«äº†å®ç°è‡ªç‰¹å¾ `Summary` çš„é‚£äº›æ–¹æ³•ï¼ˆæ¯”å¦‚ `summarize`ï¼‰ï¼Œå› æ­¤ `post` åªèƒ½è°ƒç”¨å®ç°äºç‰¹å¾ `Summary` çš„ `summarize` æ–¹æ³•ï¼Œè€Œä¸èƒ½è°ƒç”¨ç±»å‹ `Post` æœ¬èº«å®ç°çš„æ–¹æ³•å’Œç±»å‹ `Post` å®ç°äºå…¶ä»–ç‰¹å¾çš„æ–¹æ³•ã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼Œ`post` æ˜¯å“ªä¸ªç‰¹å¾å¯¹è±¡çš„å®ä¾‹ï¼Œå®ƒçš„ `vtable` ä¸­å°±åŒ…å«äº†è¯¥ç‰¹å¾çš„æ–¹æ³•ã€‚**



### Self ä¸ self

- åœ¨ Rust ä¸­ï¼Œæœ‰ä¸¤ä¸ª`self`ï¼Œä¸€ä¸ªæŒ‡ä»£å½“å‰çš„å®ä¾‹å¯¹è±¡ï¼Œä¸€ä¸ªæŒ‡ä»£ç‰¹å¾æˆ–è€…æ–¹æ³•ç±»å‹çš„åˆ«åï¼š

  ```rust
  trait Draw {
      fn draw(&self) -> Self;
  }
  
  #[derive(Clone)]
  struct Button;
  impl Draw for Button {
      fn draw(&self) -> Self {
          return self.clone()
      }
  }
  
  fn main() {
      let button = Button;
      let newb = button.draw();
  }
  ```

  ä¸Šè¿°ä»£ç ä¸­ï¼Œ`self`æŒ‡ä»£çš„å°±æ˜¯å½“å‰çš„å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ `button.draw()` ä¸­çš„ `button` å®ä¾‹ï¼Œ`Self` åˆ™æŒ‡ä»£çš„æ˜¯ `Button` ç±»å‹ã€‚

- å½“ç†è§£äº† `self` ä¸ `Self` çš„åŒºåˆ«åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ä½•ä¸ºå¯¹è±¡å®‰å…¨ã€‚



### ç‰¹å¾å¯¹è±¡çš„é™åˆ¶

- ä¸æ˜¯æ‰€æœ‰ç‰¹å¾éƒ½èƒ½æ‹¥æœ‰ç‰¹å¾å¯¹è±¡ï¼Œ**åªæœ‰å¯¹è±¡å®‰å…¨çš„ç‰¹å¾æ‰è¡Œ**ã€‚å½“ä¸€ä¸ªç‰¹å¾çš„**æ‰€æœ‰æ–¹æ³•**éƒ½æœ‰å¦‚ä¸‹å±æ€§æ—¶ï¼Œå®ƒçš„å¯¹è±¡æ‰æ˜¯å®‰å…¨çš„ï¼š

  - æ–¹æ³•çš„è¿”å›ç±»å‹ä¸èƒ½æ˜¯ `Self`ï¼›
  - æ–¹æ³•æ²¡æœ‰ä»»ä½•æ³›å‹å‚æ•°ï¼›

  å¯¹è±¡å®‰å…¨å¯¹äºç‰¹å¾å¯¹è±¡æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºä¸€æ—¦æœ‰äº†ç‰¹å¾å¯¹è±¡ï¼Œå°±ä¸å†éœ€è¦çŸ¥é“å®ç°è¯¥ç‰¹å¾çš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆäº†ã€‚å¦‚æœç‰¹å¾æ–¹æ³•è¿”å›äº†å…·ä½“çš„ `Self` ç±»å‹ï¼Œä½†æ˜¯ç‰¹å¾å¯¹è±¡å¿˜è®°äº†å…¶çœŸæ­£çš„ç±»å‹ï¼Œé‚£è¿™ä¸ª `Self` å°±éå¸¸å°´å°¬ï¼Œå› ä¸ºæ²¡äººçŸ¥é“å®ƒæ˜¯è°äº†ã€‚ä½†æ˜¯å¯¹äºæ³›å‹ç±»å‹å‚æ•°æ¥è¯´ï¼Œå½“ä½¿ç”¨ç‰¹å¾æ—¶å…¶ä¼šæ”¾å…¥å…·ä½“çš„ç±»å‹å‚æ•°ï¼šæ­¤å…·ä½“ç±»å‹å˜æˆäº†å®ç°è¯¥ç‰¹å¾çš„ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚è€Œå½“ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ—¶å…¶å…·ä½“ç±»å‹è¢«æŠ¹å»äº†ï¼Œæ•…è€Œæ— ä»å¾—çŸ¥æ”¾å…¥æ³›å‹å‚æ•°ç±»å‹åˆ°åº•æ˜¯ä»€ä¹ˆã€‚

  æ ‡å‡†åº“ä¸­çš„ `Clone` ç‰¹å¾å°±ä¸ç¬¦åˆå¯¹è±¡å®‰å…¨çš„è¦æ±‚ï¼š

  ```rust
  pub trait Clone {
      fn clone(&self) -> Self;
  }
  ```

  å› ä¸ºå®ƒçš„å…¶ä¸­ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å›äº† `Self` ç±»å‹ï¼Œå› æ­¤å®ƒæ˜¯å¯¹è±¡ä¸å®‰å…¨çš„ã€‚

- `String` ç±»å‹å®ç°äº† `Clone` ç‰¹å¾ï¼Œ `String` å®ä¾‹ä¸Šè°ƒç”¨ `clone` æ–¹æ³•æ—¶ä¼šå¾—åˆ°ä¸€ä¸ª `String` å®ä¾‹ã€‚ç±»ä¼¼çš„ï¼Œå½“è°ƒç”¨ `Vec<T>` å®ä¾‹çš„ `clone` æ–¹æ³•ä¼šå¾—åˆ°ä¸€ä¸ª `Vec<T>` å®ä¾‹ã€‚`clone` çš„ç­¾åéœ€è¦çŸ¥é“ä»€ä¹ˆç±»å‹ä¼šä»£æ›¿ `Self`ï¼Œå› ä¸ºè¿™æ˜¯å®ƒçš„è¿”å›å€¼ã€‚

  å¦‚æœè¿åäº†å¯¹è±¡å®‰å…¨çš„è§„åˆ™ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºä½ ã€‚

  ```shell
  error[E0038]: the trait `std::clone::Clone` cannot be made into an object
  ```

  è¿™æ„å‘³ç€ä¸èƒ½ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨æ­¤ç‰¹å¾ä½œä¸ºç‰¹å¾å¯¹è±¡ã€‚



```sql
SELECT mem_usage FROM mydb 
WHERE local=wuhan AND id=1 AND time>='2020-02-01' 
GROUP BY time(5 min)
```

